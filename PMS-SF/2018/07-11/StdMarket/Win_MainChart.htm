<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <script src="/Scripts/boot.js?v=$AppVersion" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/ComTools.js?v=$AppVersion" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/SingleForm.js?v=$AppVersion" type="text/javascript"></script>
    <script src="/Form/Init/$Model.data.FormId/$Model.data.FormState/$Model.data.KeyValue"></script>
    <script src="/Scripts/plugins/echarts/echarts.js"></script>
    <script type="text/javascript" src="/Scripts/plugins/highcharts/highcharts.js"></script>
    <script type="text/javascript" src="/Scripts/plugins/highcharts/highcharts-more.js"></script>
    <script type="text/javascript" src="/Scripts/plugins/highcharts/funnel.js"></script>
    <script type="text/javascript" src="/Scripts/plugins/highcharts/themes/grid-light.js"></script>
    <script type="text/javascript" hasvelocity="true">
        var currentproj = "$!CurrentSession.EpsProjId";
        var longcode = "$!CurrentSession.EpsProjLongCode";//
        var EpsProjName = "$!CurrentSession.EpsProjName";

    </script>
    <style>
        html, body {
            height: 100%;
        }

        body {
            padding-right: 5px;
        }

            body > .portlet.box {
                margin-bottom: 0;
            }

        .page-header-fixed {
            padding-top: 36px;
        }

        @media(max-width:992px) and (min-width:768px) {
            .row-stat .col-md-3 {
                width: 25%;
                float: left;
            }
        }

        @media(min-width:360px) and (max-width:768px) {
            .row-stat .col-md-3 {
                width: 50%;
                float: left;
                margin-bottom: 10px;
            }
        }

        @media(max-width:480px) {
            .setting-actions .btn {
                margin-bottom: 8px;
            }
        }

        .panel-gray-alt .panel-heading {
            background-color: #f9f9f9;
        }

        .panel-gray-alt hr {
            border-color: #aaa;
            border-width: 1px;
        }

        .panel .progress {
            clear: both;
        }

        .panel .progress-bar {
            background-color: #D9534F;
        }

            .panel .progress-bar > .progress-value {
                left: auto;
                right: 0;
                bottom: 100%;
                margin-top: -14px;
                margin-right: -10px;
            }

        .panel-icon {
            background: rgba(255,255,255,0.9);
            -moz-border-radius: 3px;
            -webkit-border-radius: 3px;
            border-radius: 3px;
            width: 60px;
            height: 60px;
            float: left;
            margin-right: 15px;
            line-height: 70px;
            text-align: center;
        }

            .panel-icon .fa {
                color: #000;
                font-size: 36px;
                margin: 0;
            }

        .panel-bluegreen .panel-icon .fa {
            color: #03c3c4;
        }

        .panel-violet .panel-icon .fa {
            color: #905dd1;
        }

        .panel-blue .panel-icon .fa {
            color: #428bca;
        }

        .panel-icon {
            margin-right: 0;
            background: none;
        }

            .panel-icon .fa {
                color: white;
            }

        .panel h4 {
            font-size: 16px;
        }

        .panel-gray-alt {
            border-color: #ddd;
        }

            .panel-gray-alt .panel-heading {
                background-color: #F7F7F7;
                color: #777;
            }

        .panel .md-title {
            padding: 0;
            border-left: 0;
        }
        /*content wrapper*/
        #content-wrapper > .row {
            position: relative;
            height: calc(50% - 27px);
        }

        #content-wrapper .row .row,
        #content-wrapper .row div[class^=col-] {
            height: 100%;
        }

            #content-wrapper .row div[class^=col-] div[class^=col-]:first-child {
                padding-left: 0;
            }

            #content-wrapper .row div[class^=col-] div[class^=col-]:last-child {
                padding-right: 0;
            }

        #content-wrapper .row .color-board {
            width: auto;
            height: calc(50% - 2.5px);
        }
        /*charts*/
        #chart-wrapper {
            height: 100%;
            padding: 0 295px 5px 5px;
        }
        /*statistic board*/
        .diy-tooltip {
            position: absolute;
            width: 200px;
            padding: 5px;
            border-radius: 4px;
            color: white;
            background-color: rgba(0,0,0,0.8);
        }

        #board-wrapper {
            position: absolute;
            top: 0;
            right: 5px;
            width: 285px;
            height: 100%;
            padding-left: 5px;
        }

            #board-wrapper .color-board {
                height: calc(25% - 5px);
            }
        /*timeline*/
        #timeline-wrapper {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 0 4px;
        }

        #timeline-detail {
            position: absolute;
            bottom: 37px;
            display: none;
            height: auto;
            opacity: 0;
            z-index: 2;
        }

            #timeline-detail li {
                padding: 0 3px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
            }

        #timeline-wrapper .table {
            margin-bottom: 0;
        }

            #timeline-wrapper .table th {
                position: relative;
                cursor: pointer;
                transition: 1s;
                -webkit-transition: 1s;
                -moz-transition: 1s;
            }

                #timeline-wrapper .table th:before,
                #timeline-wrapper .table th:after {
                    transition: 1s;
                    -webkit-transition: 1s;
                    -moz-transition: 1s;
                }

                #timeline-wrapper .table th > span {
                    position: relative;
                    padding-left: 25px;
                }

                    #timeline-wrapper .table th > span:before {
                        content: "";
                        position: absolute;
                        top: 4px;
                        left: 0;
                        width: 14px;
                        height: 14px;
                        border: 1px solid rgba(255,255,255,.5);
                        border-radius: 50%;
                        transition: 1s;
                        -webkit-transition: 1s;
                        -moz-transition: 1s;
                    }

        .table .th-orange:before,
        .table .th-orange:after {
            background-color: #FFB848;
        }

        .table .th-dark-green:before,
        .table .th-dark-green:after {
            background-color: #0AA699;
        }

        .table .th-green:before,
        .table .th-green:after {
            background-color: #5CB85C;
        }

        .table .th-blue:before,
        .table .th-blue:after {
            background-color: #428BCA;
        }

        #timeline-wrapper .table th {
            padding-left: 20px;
        }

            #timeline-wrapper .table th:first-child {
                padding-left: 12px;
            }

            #timeline-wrapper .table th:after {
                content: "";
                position: absolute;
                top: 0;
                right: -10px;
                width: 36px;
                height: 36px;
                border-bottom-left-radius: 100%;
                border-top-right-radius: 5px;
                border-top: 2px solid #ddd;
                border-right: 2px solid #ddd;
                transform: scale(0.71) rotate(45deg);
                -ms-transform: scale(0.71) rotate(45deg);
                -webkit-transform: scale(0.71) rotate(45deg);
                z-index: 2;
            }

            #timeline-wrapper .table th:last-child:after {
                content: none;
            }

            #timeline-wrapper .table th:before {
                content: "";
                position: absolute;
                top: 0;
                left: -8px;
                width: 10px;
                height: 36px;
                z-index: 1;
            }

            #timeline-wrapper .table th:first-child:before {
                content: none;
            }

        #timeline-wrapper .table .th-bg-first,
        #timeline-wrapper .table .th-bg-first:before,
        #timeline-wrapper .table .th-bg-first:after {
            background-color: #87cefa;
        }

        #timeline-wrapper .table .th-bg-second,
        #timeline-wrapper .table .th-bg-second:before,
        #timeline-wrapper .table .th-bg-second:after {
            background-color: #56baf8;
        }

        #timeline-wrapper .table .th-bg-third,
        #timeline-wrapper .table .th-bg-third:before,
        #timeline-wrapper .table .th-bg-third:after {
            background-color: #25a6f6;
        }

        #timeline-wrapper .table .th-bg-forth,
        #timeline-wrapper .table .th-bg-forth:before,
        #timeline-wrapper .table .th-bg-forth:after {
            background-color: #098ddf;
        }

        #timeline-wrapper .table .th-bg-five,
        #timeline-wrapper .table .th-bg-five:before,
        #timeline-wrapper .table .th-bg-five:after {
            background-color: #0776ba;
        }

        .table .th-orange:hover,
        .table .th-orange.selected,
        .table .th-orange:hover:after,
        .table .th-orange.selected:after {
            background-color: #ffa00b;
        }

        .table .th-dark-green:hover,
        .table .th-dark-green.selected,
        .table .th-dark-green:hover:before,
        .table .th-dark-green.selected:before,
        .table .th-dark-green:hover:after,
        .table .th-dark-green.selected:after {
            background-color: #07766d;
        }

        .table .th-green:hover,
        .table .th-green.selected,
        .table .th-green:hover:before,
        .table .th-green.selected:before,
        .table .th-green:hover:after,
        .table .th-green.selected:after {
            background-color: #449d44;
        }

        .table .th-blue:hover,
        .table .th-blue.selected,
        .table .th-blue:hover:before,
        .table .th-blue.selected:before,
        .table .th-blue:hover:after,
        .table .th-blue.selected:after {
            background-color: #3071a9;
        }

        #timeline-wrapper .table th:hover > span:before,
        #timeline-wrapper .table th.selected > span:before {
            border-color: 1px solid white;
            background-color: rgba(0,0,0,0.4);
        }
        /*gcl.css*/
        #content-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
        }

            #content-wrapper .row {
                margin: 0 0 8px;
            }

                #content-wrapper .row:last-child {
                    margin-bottom: 0;
                }

        .color_box {
            height: 100%;
            width: 100%;
            border: 1px solid;
            border-top-left-radius: 3px;
            border-top-right-radius: 3px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
        }

            .color_box .box-header {
                height: 30px;
                padding: 3px 6px;
                border-bottom: 1px solid;
                background-color: #f7f7f7;
            }

            .color_box .box-title {
                display: inline-block;
                height: 20px;
                color: black;
                padding-left: 5px;
                margin: 0;
                font-size: 15px;
                line-height: 20px;
            }

            .color_box .box-actions {
                float: right;
            }

                .color_box .box-actions label {
                    color: black;
                }

                .color_box .box-actions .btn-group {
                    margin-right: 3px;
                }

                    .color_box .box-actions .btn-group:last-child {
                        margin-right: 0;
                    }

                .color_box .box-actions .btn-default {
                    padding: 0 3px;
                }

                    .color_box .box-actions .btn-default:first-child {
                        width: 65px;
                        text-align: center;
                    }

                        .color_box .box-actions .btn-default:first-child:hover,
                        .color_box .box-actions .btn-default:first-child:active {
                            background-color: white;
                        }

                .color_box .box-actions .dropdown-toggle {
                    padding: 0 6px;
                }

                .color_box .box-actions .dropdown-menu {
                    min-width: auto;
                    width: 100%;
                }

                    .color_box .box-actions .dropdown-menu li > a {
                        padding: 2px 5px;
                    }

            .color_box .box-content {
                height: calc(100% - 27px);
                width: 100%;
                padding: 4px 8px;
                overflow: hidden;
            }

            .color_box.cb-blue {
                color: #428bca;
            }

                .color_box.cb-blue .color-header {
                    color: #428bca;
                }

                .color_box.cb-blue .dropdown-toggle {
                    background-color: #428bca;
                }

                    .color_box.cb-blue .dropdown-toggle span {
                        color: #ffffff;
                    }

            .color_box.cb-orange {
                color: #ffb848;
            }

                .color_box.cb-orange .color-header {
                    color: #ffb848;
                }

                .color_box.cb-orange .dropdown-toggle {
                    background-color: #ffb848;
                }

                    .color_box.cb-orange .dropdown-toggle span {
                        color: #ffffff;
                    }

            .color_box.cb-dark-green {
                color: #0aa699;
            }

                .color_box.cb-dark-green .color-header {
                    color: #0aa699;
                }

                .color_box.cb-dark-green .dropdown-toggle {
                    background-color: #0aa699;
                }

                    .color_box.cb-dark-green .dropdown-toggle span {
                        color: #ffffff;
                    }

            .color_box.cb-green {
                color: #5cb85c;
            }

                .color_box.cb-green .color-header {
                    color: #5cb85c;
                }

                .color_box.cb-green .dropdown-toggle {
                    background-color: #5cb85c;
                }

                    .color_box.cb-green .dropdown-toggle span {
                        color: #ffffff;
                    }

        .color-board {
            width: 280px;
            height: 110px;
            background-color: rgba(252,252,252,.9);
            overflow: hidden;
            margin-top: 5px;
        }

            .color-board:first-child {
                margin-top: 0;
            }

            .color-board .board-header {
                position: relative;
                height: 26px;
                padding: 3px 4px;
                border-top-left-radius: 3px;
                border-top-right-radius: 3px;
            }

            .color-board .board-title {
                width: 100%;
                height: 20px;
                color: white;
                margin: 0;
                padding: 0 32px 0 5px;
            }

                .color-board .board-title i {
                    padding-right: 5px;
                }

            .color-board .board-more {
                position: absolute;
                top: 4px;
                right: 8px;
                display: none;
                color: white;
                cursor: pointer;
                font-size: 13px;
            }

            .color-board .board-content {
                position: relative;
                width: 100%;
                height: calc(100% - 26px);
                padding: 3px;
            }

                .color-board .board-content > div {
                    width: 100%;
                    height: 100%;
                    display: inline-block;
                }

                .color-board .board-content > .half-width {
                    position: relative;
                    width: calc(50% - 2.5px);
                }

                .color-board .board-content > .quarter-width {
                    position: relative;
                    width: calc(25% - 4px);
                }

                .color-board .board-content > .triple-width {
                    position: relative;
                    width: calc(33% - 4px);
                }

                .color-board .board-content h5 {
                    text-align: center;
                    font-size: 14px;
                    line-height: 18px;
                }

                .color-board .board-content h6 {
                    text-align: center;
                    font-size: 13px;
                    line-height: 15px;
                    cursor: pointer;
                }

                .color-board .board-content span[class^=status] {
                    display: inline-block;
                    margin: 0 25px 0 32px;
                    width: 15px;
                    height: 15px;
                    border-radius: 50%;
                    border: 1px solid rgba(0,0,0,.5);
                }

                .color-board .board-content .table {
                    position: relative;
                    top: 50%;
                    transform: translateY(-50%);
                    -ms-transform: translateY(-50%);
                    -webkit-transform: translateY(-50%);
                    -moz-transform: translateY(-50%);
                }

                .color-board .board-content td {
                    padding: 8px 10px;
                    border-top: none;
                    cursor: pointer;
                }

            .color-board .board-icon {
                position: absolute;
                width: 80px;
                height: 80px;
                left: -5px;
                bottom: -5px;
            }

                .color-board .board-icon * {
                    width: 80px;
                    height: 80px;
                    line-height: 80px;
                    font-size: 80px;
                    opacity: 0.2;
                    filter: alpha(opacity=20);
                }

            .color-board .board-detail {
                position: relative;
                top: 50%;
                transform: translateY(-70%);
                width: 100%;
                padding-left: 60px;
            }

                .color-board .board-detail h5 {
                    margin: 8px 0;
                    text-align: right;
                    cursor: pointer;
                }

                    .color-board .board-detail h5 span {
                        float: right;
                        padding: 0 15px;
                        width: 100px;
                        text-align: center;
                    }

                .color-board .board-detail td {
                    padding: 3px;
                    cursor: pointer;
                }

            .color-board.cb-bg-skyblue .board-header {
                background-color: #1c75bf;
            }

            .color-board.cb-bg-skyblue .board-content {
                border: 1px solid #1c75bf;
                border-top: none;
            }

            .color-board.cb-bg-green .board-header {
                background-color: #5cb85c;
            }

            .color-board.cb-bg-green .board-content {
                border: 1px solid #5cb85c;
                border-top: none;
            }

            .color-board.cb-bg-green .board-icon * {
                color: #5cb85c;
            }

            .color-board.cb-bg-blue .board-header {
                background-color: #428bca;
            }

            .color-board.cb-bg-blue .board-content {
                border: 1px solid #428bca;
                border-top: none;
            }

            .color-board.cb-bg-blue .board-icon * {
                color: #428bca;
            }

            .color-board.cb-bg-dark-green .board-header {
                background-color: #0aa699;
            }

            .color-board.cb-bg-dark-green .board-content {
                border: 1px solid #0aa699;
                border-top: none;
            }

            .color-board.cb-bg-dark-green .board-icon * {
                color: #0aa699;
            }

            .color-board.cb-bg-orange .board-header {
                background-color: #ffb848;
            }

            .color-board.cb-bg-orange .board-content {
                border: 1px solid #ffb848;
                border-top: none;
            }

            .color-board.cb-bg-orange .board-icon * {
                color: #ffb848;
            }

        .projectNameCell {
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
            color: #428bca;
            cursor: pointer;
        }

        .status-normal {
            background-color: #70ad47;
        }

        .status-warning {
            background-color: #ffff00;
        }

        .status-danger {
            background-color: #ff0000;
        }

        .color-board .board-header {
            position: relative;
            height: 50px;
            padding: 15px 8px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
        }

        .color-board .board-content {
            position: relative;
            width: 100%;
            height: calc(100% - 50px);
            padding: 3px;
            background-color: #F7F7F7;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .color_box {
            height: 100%;
            width: 100%;
            border: 1px solid;
            border-top-left-radius: 3px;
            border-top-right-radius: 3px;
            box-shadow: 0px 0px 0px rgba(0,0,0,0.4);
        }

            .color_box.cb-white {
                color: #FFFFFF;
            }

        .color-board.cb-bg-skyblue .board-header {
            background-color: #1c75bf;
        }

        .color-board.cb-bg-skyblue .board-content {
            border: 0px solid #1c75bf;
            border-top: none;
        }

        .color-board.cb-bg-zise .board-header {
            background-color: #27c24c;
        }

        .color-board.cb-bg-zise .board-content {
            border: 0px solid #762da2;
            border-top: none;
        }

        .color-board.cb-bg-lan .board-header {
            background-color: #fa9e0d;
        }

        .color-board.cb-bg-lan .board-content {
            border: 0px solid #0072c4;
            border-top: none;
        }

        .color-board.cb-bg-huang .board-header {
            background-color: #f05050;
        }

        .color-board.cb-bg-huang .board-content {
            border: 0px solid #fdc101;
            border-top: none;
        }

        .color-board.cb-bg-hong .board-header {
            background-color: #c70006;
        }

        .color-board.cb-bg-hong .board-content {
            border: 0px solid #c70006;
            border-top: none;
        }

        .color-board .board-title {
            width: 100%;
            height: 20px;
            color: white;
            margin: 0;
            padding: 0 0px 0 0px;
            text-align: center;
        }

        #YearInvestmentDiv .board-content, #ActiveProjectDiv .board-content {
            cursor: pointer;
        }

        .progressbar {
            margin-top: 2px;
            position: relative;
            background: #bbb;
            width: 100%;
            height: 18px;
            overflow: hidden;
        }

        .progressbar-percent {
            position: absolute;
            height: 18px;
            background: blue;
            left: 0;
            top: 0px;
            overflow: hidden;
            z-index: 1;
        }

        .progressbar-label {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            font-size: 13px;
            color: White;
            z-index: 10;
            text-align: center;
            height: 16px;
            line-height: 16px;
        }

        .bg-darkblue {
            background: #0AA699 !important;
            color: #fff !important;
        }

        .bg-red {
            background: #dd7d0c !important;
            color: #fff !important;
        }

        .bg-green {
            background: #8cbf26 !important;
            color: #fff !important;
        }

        .bg-yellow {
            background: #fa9e0d !important;
            color: #fff !important;
        }

        .bg-header {
            border-radius: 5px;
            padding: 10px 15px;
            border-bottom: 1px solid transparent;
            border-top-right-radius: 3px;
            border-top-left-radius: 3px;
        }

        .mini-textbox-input, .mini-buttonedit-input {
            height: 22px;
            padding: 0px;
            line-height: 22px;
            font-family: "Microsoft Yahei",Tahoma,Verdana;
            font-size: 14px;
            color: #555;
        }
    </style>

</head>

<body>
    <div id="content-wrapper" class="tabbable-line page-nav-tabs">
        <div class="row" style="height:calc(57% - 27px)">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="color_box cb-blue">
                    <div class="box-header">
                        <h5 class="box-title">项目信息列表列表</h5>
                        <div class="box-actions">
                            <label>项目名称</label>
                            <div class="btn-group">
                                <input id="V_PS_ProjectInfo.ProjectName" name="ProjectName" width="150" onenter="ProjectNameChange" class="mini-textbox" />
                            </div>
                            <label>项目类型</label>
                            <div class="btn-group">
                                <input id="V_PS_ProjectInfo.QProjectType" name="QProjectType" width="100" onvaluechanged="ProjectNameChange" class="mini-combobox" />
                            </div>
                            <label>产品类型</label>
                            <div class="btn-group">
                                <input id="V_PS_ProjectInfo.QProductType" name="QProductType" width="100" onvaluechanged="ProjectNameChange" class="mini-combobox" />
                            </div>
                            <label>跟进状态</label>
                            <div class="btn-group">
                                <input id="V_PS_ProjectInfo.QFollowStatus" name="QFollowStatus" width="100" onvaluechanged="ProjectNameChange" class="mini-combobox" />
                            </div>

                            <label>跟进人</label>
                            <div class="btn-group">
                                <input id="V_PS_ProjectInfo.FollowHuman" name="FollowHuman" width="100" onenter="ProjectNameChange" class="mini-textbox" />
                            </div>
                        </div>
                    </div>
                    <div class="box-content">
                        <div id="V_PS_ProjectInfo" class="mini-datagrid" style="width: 100%; height: 100%;"
                             pagesize="10" ondrawgroup="onDrawGroup" idfield="Id" onrowdblclick="rowdblclick">
                            <div property="columns">
                                <div field="ProjectId" name="ProjectId" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="项目编号" align="left">项目编号<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div field="ProjectName" name="ProjectName" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="项目名称" align="left">项目名称<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div type="comboboxcolumn" field="ProjectType" name="ProjectType" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="项目类型" align="left">项目类型<input property="editor" class="mini-combobox" style="width: 100%;" /></div>

                                <div field="ProjectLocation" name="ProjectLocation" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="项目地点" align="left">项目地点<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div type="comboboxcolumn" field="ProductType" name="ProductType" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="产品类型" align="left">产品类型<input property="editor" class="mini-combobox" style="width: 100%;" /></div>

                                <div field="ProjectInvestAmount" name="ProjectInvestAmount" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="投资规模" align="left">投资规模<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div type="comboboxcolumn" field="FollowLevel" name="FollowLevel" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="跟踪级别" align="left">跟踪级别<input property="editor" class="mini-combobox" style="width: 100%;" /></div>

                                <div type="comboboxcolumn" field="FollowStatus" name="FollowStatus" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="跟进状态" align="left">跟进状态<input property="editor" class="mini-combobox" style="width: 100%;" /></div>

                                <div field="FollowHuman" name="FollowHuman" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="跟进人名称" align="left">跟进人名称<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div field="comentnum" name="comentnum" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="跟进次数" align="left">跟进次数<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div field="FollowDate" name="FollowDate" headeralign="center" accesskey="60" guideid="" datatype="" allowsort="true" currencyunit="" header="最新跟进日期" dateformat="yyyy-MM-dd" align="left">最新跟进日期<input property="editor" class="mini-datepicker" style="width: 100%;" /></div>

                                <div field="CommentText" name="CommentText" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="最新动态" align="left">最新动态<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div type="checkboxcolumn" field="isBid" truevalue="1" falsevalue="0" headeralign="center">是否投标</div>

                                <div type="comboboxcolumn" field="BidResult" name="BidResult" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="投标结果" align="left">投标结果<input property="editor" class="mini-combobox" style="width: 100%;" /></div>

                                <div field="reviewStatus" name="reviewStatus" headeralign="center" guideid="" datatype="" allowsort="true" currencyunit="" header="合同评审状态" align="left">合同评审状态<input property="editor" class="mini-textbox" style="width: 100%;" /></div>

                                <div field="RegDate" name="RegDate" headeralign="center" accesskey="60" guideid="" datatype="" allowsort="true" currencyunit="" header="录入日期" dateformat="yyyy-MM-dd" align="left">录入日期<input property="editor" class="mini-datepicker" style="width: 100%;" /></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="height:calc(43% - 27px)">
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="color_box cb-blue">
                    <!--<div class="box-header">
                        <h5 class="box-title">项目概况</h5>
                    </div>-->
                    <div class="box-content" style="height:100%!important;">
                        <div id="Charts1" style="height: 100%;">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-sm-6">
                <div class="color_box cb-blue">
                    <!--<div class="box-header">
                        <h5 class="box-title">项目完成产值情况</h5>

                    </div>-->
                    <div class="box-content" style="height:100%!important;">
                        <div id="Charts2" style="height: 100%;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" style="height:calc(43% - 27px)">
            <div class="col-lg-12 col-md-12 col-sm-12">
                <div class="color_box cb-blue">
                    <div class="box-header">
                        <h5 class="box-title">年度合同额</h5>
                        <div class="box-actions">
                            <label>年度</label>
                            <div class="btn-group">
                                <input id="QStartDate" class="mini-monthpicker"  format="yyyy" width="120px" />
                            </div>
                        </div>
                    </div>
                    <div class="box-content" style="height:100%!important;">
                        <div id="charthere" style="height: 100%;">
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!--<div class="row-wrap">
        <div class="row  row-hd row-hd-responsive" style="height: 100%">
            <div class="col-md-12 col-hd-12">
                    <div class="portlet box blue" style="height: 28px;">
                        <div class="portlet-title gray">
                        <div class="captiontools">
                            <a class="mini-button gray" id="preliminary"><i class="fa fa-line-chart"></i>前期项目动态</a>
                            <a class="mini-button gray" id="Amount"><i class="fa  fa-bar-chart"></i>年度合同额</a>
                            <a class="mini-button gray" id="Distribute"><i class="fa fa-pie-chart"></i>年度合同分布</a>
                               <span>切换EPS</span>
                            <input id="txtPlanName" class="mini-buttonEdit" allowinput="false" shownullitem="true" width="150px" />
                            <span id="SstartDate">年度</span>
                            <input id="QStartDate" class="mini-monthpicker" format="yyyy" width="120px"></input>
                            <a class="mini-button gray" id="btnSearch"><i class="fa fa-search"></i>查询</a>
                        </div>
                    </div>
                    </div>
                    <div class="portlet box blue" style="height: 90%;">
                    <div class="portlet-title gray">
                        <div class="captiontools">
                        </div>
                    </div>
                    <div class="portlet-body" style="height: 100%">
                        <div  class="mini-fit">
                            <div id="charthere" style="display:none;width:100%;height:100%" >
                            </div>
                            <div id="Managecharts" class="row" >
                                <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12" >
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div  id="Charts1" style="height:380px;"></div>
                                        </div>
                                    </div>
                                </div>
                                <div  class="col-lg-6 col-md-6 col-sm-12 col-xs-12" >
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div  id="Charts2" style="height: 380px;"></div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    </div>
            </div>
        </div>
    </div>-->
    <script type="text/javascript">
        mini.parse();
        var currentplan, currenttask, Types, typeData;

        var PowerForm = new SingleForm();
        $(function () {
            PowerForm.Init();
            currenttask = currentproj;
            currentplan = longcode;
            mini.get("QStartDate").setValue((new Date()).getFullYear() + "-1-1");
            //SetBtnEditValue("txtPlanName",EpsProjName);
            //Types="preliminary";
            //ShowCharts(Types);
            Loadpreliminary();
            LoadAmountData();
        });
        function rowdblclick(e) {
            var ids = "1ce86783-1a7b-45b5-95ff-b6d1afdaa56b";
            PowerForm.OnBtnViewForm({ id: "V_PS_ProjectInfo.ViewForm" }, ids);
        }
        //mini.get("txtPlanName").on("buttonclick", function (e) {
        //    OnWiardPlan();
        //})
        function ProjectNameChange() {
            mini.get("V_PS_ProjectInfo").reload();
            Loadpreliminary();
        }
        function onDrawGroup(e) {
            e.cellHtml = "项目名称：" + e.value;
        }
        function getgridwhere() {
            var where = " 1=1 ";
            if (mini.get("V_PS_ProjectInfo.ProjectName").getValue() != "") {
                where += " and ProjectName like '%" + mini.get("V_PS_ProjectInfo.ProjectName").getValue() + "%'";

            }

            if (mini.get("V_PS_ProjectInfo.QProjectType").getValue() != "") {
                where += " and ProjectType= '" + mini.get("V_PS_ProjectInfo.QProjectType").getValue() + "'";

            }

            if (mini.get("V_PS_ProjectInfo.QProductType").getValue() != "") {
                where += " and ProductType= '" + mini.get("V_PS_ProjectInfo.QProductType").getValue() + "'";

            }

            if (mini.get("V_PS_ProjectInfo.QFollowStatus").getValue() != "") {
                where += " and FollowStatus= '" + mini.get("V_PS_ProjectInfo.QFollowStatus").getValue() + "'";

            }

            if (mini.get("V_PS_ProjectInfo.FollowHuman").getValue() != "") {
                where += " and FollowHuman like '%" + mini.get("V_PS_ProjectInfo.FollowHuman").getValue() + "%'";


            }
            return where;
        }
        PowerForm.EventBeforeLoadData = function (e) {
            if (e.sender.id == "V_PS_ProjectInfo") {
                var where = getgridwhere();
                if (where != "") {
                    if (e.params.swhere != "")
                        e.params.swhere += " and " + where;
                    else
                        e.params.swhere = where;
                }

                var Client_Guid = getParameter("Client_Guid");
                if (Client_Guid) {
                    var where = " Client_Guid = '" + Client_Guid + "'";

                    if (e.params.swhere != "")
                        e.params.swhere += " and " + where;
                    else
                        e.params.swhere = where;
                }

                //var Nofilter = getParameter("Nofilter");
                //if (Nofilter) {
                    var exp = { defaultright: false };
                    var str = mini.encode(exp);
                    str = base64encode(str);
                    e.params.extparams = str;
                    var where = " EpsProjId in(select project_guid from PLN_project where (LongCode like '" + longcode + ".%' or LongCode ='"+longcode+"') )"
                    if (e.params.swhere != "")
                        e.params.swhere += " and " + where;
                    else
                        e.params.swhere = where;

                //}
            }

        }
        function OnWiardPlan() {
            var p = { title: "选择项目计划", multi: "0" };
            p.url = "/Form/OpenURL?url=/PowerPlat/FormXml/zh-CN/StdSystem/WizardEPSProject.htm";
            p.swhere = " (LongCode Like '" + longcode + ".%' or LongCode='" + longcode + "') and project_type=0";
            p.select = "project_guid,parent_guid,project_shortname,project_name,LongCode";
            OpenWizard(p, function (data) {
                currenttask = data[0].project_guid;
                currentplan = data[0].LongCode;
                SetBtnEditValue("txtPlanName", data[0].project_name);
                LoadDatas();
            })
        }
        function SetBtnEditValue(id, value) {
            var btn = mini.get(id);
            btn.setText(value);
            btn.setValue(value);
        }
        mini.get("QStartDate").on("valuechanged", function () {
            LoadAmountData();
        })

        //mini.get("btnSearch").on("click", function (e) {
        //    LoadDatas();
        //})
        //mini.get("preliminary").on("click", function (e) {
        //    //LoadData();
        //	Types="preliminary";
        //	ShowCharts(Types);
        //	LoadDatas();
        //})
        //  mini.get("Amount").on("click", function (e) {
        //    //LoadData();
        //	Types="Amount";
        //	ShowCharts(Types);
        //	LoadDatas();
        //})

        //  mini.get("Distribute").on("click", function (e) {
        //    //LoadData();
        //	Types="Distribute";
        //	ShowCharts(Types);
        //	LoadDatas();
        //})

        // mini.get("Scale").on("click", function (e) {
        //LoadData();
        //	Types="Scale";
        //	ShowCharts(Types);
        //	LoadDatas();
        //  })
        //function ShowCharts(type){
        //  if(type=="preliminary"){
        //   $("#QStartDate").hide();
        //   $("#SstartDate").hide();
        //  }else{
        //   $("#QStartDate").show();
        //   $("#SstartDate").show();
        //  }
        //  if(type=="Amount")
        //  {
        //   $("#Managecharts").hide();
        //   $("#charthere").show();

        //  }else{
        //   $("#charthere").hide();
        //   $("#Managecharts").show();
        //  }
        //}
        //function LoadDatas(){
        // if(Types=="preliminary")
        // {
        // typeData=null;
        //   Loadpreliminary();
        // }
        // if(Types=="Amount")
        // {
        // typeData=null;
        // LoadAmountData();
        // }
        // if(Types=="Distribute")
        //{
        //typeData=null;
        // LoadDistribute();
        //}
        //}
        //function LoadDistribute(){

        //	var Times = mini.get("QStartDate").getValue();
        //	var currentYearFirstDate=Times.getFullYear() + "-1-1";   //本年第一天
        //	var currentYearLastDate=Times.getFullYear() + "-12-31";//本年最后一天
        //	var p = {};
        //	p.Longcode = currentplan;
        //	p.stratData = currentYearFirstDate;
        //    p.EndData = currentYearLastDate;
        //	LoadDistribute1(p);
        //	LoadDistribute2(p);
        //}
        //function LoadDistribute1(data){
        //$.ajax({
        //        url: "/Market/GetContractTypeChart",
        //        data: data,
        //        type: "POST",
        //        success: function (text) {
        //            var o = mini.decode(text);
        //            if (o.success) {
        //                LoadTypeChart(o.list,"合同类型统计饼形图","合同类型","Charts1");
        //            }
        //        }

        //    });
        //}
        //function LoadTypeChart(data,titles,Names,CharsId){
        //	var legendData=[];
        //	var seriesData=[];
        //	 $.each(data, function () {
        //		legendData.push(this.Types);
        //	  var item={value:this.Num,name:this.Types};
        //		seriesData.push(item);
        //	})
        //	opt = {
        //        title: {
        //            text: titles,
        //            x: 'center'
        //        },
        //        tooltip: {
        //            trigger: 'item',
        //            formatter: "{a} <br/>{b} : {c} ({d}%)"
        //        },
        //        legend: {
        //            orient: 'vertical',
        //            x: 'left',
        //            data: legendData
        //        },
        //        series: [
        //            {
        //                name: Names,
        //                type: 'pie',
        //                radius: '30%',
        //                center: ['50%', '50%'],
        //                itemStyle: {
        //                    normal: {
        //                        label: {
        //                            formatter: '{b} : {c} ({d}%) '
        //                        },

        //                    },
        //                    emphasis: {
        //                        label: {
        //                            formatter: '{b} : {c} ({d}%)'
        //                        }
        //                    }
        //                },

        //                data:seriesData
        //            }
        //        ]
        //    };
        //    InitEChart(CharsId, opt);


        //}
        //function LoadDistribute2(data){
        //	$.ajax({
        //        url: "/Market/GetProductTypeChart",
        //        data: data,
        //        type: "POST",
        //        success: function (text) {
        //            var o = mini.decode(text);
        //            if (o.success) {
        //                LoadTypeChart(o.list,"合同产品类型统计饼形图","产品类型","Charts2");
        //            }
        //        }

        //    });
        //}

        function LoadAmountData() {
            var Times = mini.get("QStartDate").getValue();
            var currentYearFirstDate = Times.getFullYear() + "-1-1";   //本年第一天
            var currentYearLastDate = Times.getFullYear() + "-12-31";//本年最后一天
            var p = {};
            p.plan_guid = currenttask;
            p.stratData = currentYearFirstDate;
            p.EndData = currentYearLastDate;
            $.ajax({
                url: "/Market/GetContractInfoChart",
                data: p,
                type: "POST",
                success: function (text) {
                    var o = mini.decode(text);
                    if (o.success) {
                        typeData = o.data;
                        LoadAmountChart(o.list, o.data);
                    }
                }

            });
        }
        function LoadAmountChart(list, datas) {
            //标题
            var opt = {};
            var xaxis = { type: 'category', data: [] };

            var curmax = 0;
            var texts = { data: [] };
            var Summax = 0;
            var series = [];
            for (var key in datas) {
                var itme = { "name": datas[key], type: 'bar', data: [] };
                texts.data.push(datas[key]);
                var Ids = key;
                var IdSum = datas[key] + '累计金额';
                texts.data.push(IdSum);
                var Sum = 0;
                var itmes = { "name": IdSum, type: 'line', yAxisIndex: 1, data: [] };
                $.each(list, function () {
                    for (var key in this) {
                        if (key == Ids) {
                            var values = Math.round(this[key] / 10000 * 100) / 100;
                            Sum += parseFloat(this[key]);
                            var Sumvalues = Math.round(Sum / 10000 * 100) / 100
                            if (Sum > Summax) Summax = Sumvalues;
                            if (parseFloat(this[key]) > curmax) curmax = values;
                            itme.data.push(values);
                            itmes.data.push(Sumvalues);

                        }
                    }
                })
                series.push(itme);
                series.push(itmes);
            }

            $.each(list, function () {
                xaxis.data.push(this.stratData);

            })
            //opt.calculable = true;
            opt.title = { text: "" };
            opt.grid = { x: 150, x2: 150 };
            opt.tooltip = { trigger: 'axis' };
            opt.toolbox = { show: false };
            opt.legend = texts;
            //opt.legend = { data: ["EPC合同", "设计合同", "合计"] };
            opt.xAxis = [xaxis];
            opt.yAxis = [{ type: 'value', name: '金额(万元)', min: 0 }, { type: 'value', name: '累计金额(万元)', min: 0 }];
            opt.series = series;
            InitEChart("charthere", opt);

        }


        function Loadpreliminary() {
            var p = {};
            p.LongCode = currentplan;
            var where = getgridwhere();
            p.where = " and " + where;
            $.ajax({
                url: "/Market/GetProjectInfoChart",
                data: p,
                type: "POST",
                success: function (text) {
                    var o = mini.decode(text);
                    if (o.success) {
                        LoadpreliminaryChart(o.list, o.detail);
                    }
                }

            });
        }
        //加载前期前期项目动态
        function LoadpreliminaryChart(list, detail) {
            var data1 = [];
            var data2 = [];
            var datas = mini.decode(detail);
            $.each(datas, function () {

                var Ids = this.id;
                var IdsNum = Ids + "Num";
                var Texts = this.text;

                $.each(list, function () {
                    for (var key in this) {
                        if (key == Ids) {
                            var item = [Texts, this[key]];
                            data1.push(item);
                        }
                        if (key == IdsNum) {
                            var Num = Math.round(this[key] / 10000 * 100) / 100;

                            var item = [Texts, Num];
                            data2.push(item);
                        }
                    }
                })
            })
            $('#Charts1').highcharts({
                chart: {
                    type: 'funnel',
                    marginRight: 100
                },
                title: {
                    text: '各阶段数量',
                    x: -50
                },
                plotOptions: {
                    series: {
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b> ({point.y:,.0f} )',
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black',
                            softConnector: true
                        },
                        neckWidth: '30%',
                        neckHeight: '25%',
                        point: {
                            events: {
                                click: function () {
                                    var Name = this.name;
                                    $.each(datas, function () {
                                        if (this.text == Name) {
                                            var url = '/Form/EditForm/c869aac0-31ac-4260-817b-b61308022705/?FollowStatus=' + this.id + '&Nofilter=true&Lcd=' + currentplan;
                                            //window.open(url);
                                            mini.open({ url: url, width: "80%", heigth: "160%" });

                                            return false;
                                        }

                                    })


                                }
                            }
                        }
                    }
                },
                legend: {
                    enabled: false
                },
                series: [{
                    name: '数量',
                    data: data1
                }]
            });
            $('#Charts2').highcharts({
                chart: {
                    type: 'funnel',
                    marginRight: 100
                },
                title: {
                    text: '各阶段金额',
                    x: -50
                },
                plotOptions: {
                    series: {
                        dataLabels: {
                            enabled: true,
                            format: '<b>{point.name}</b> ({point.y:,.0f} 万元)',
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black',
                            softConnector: true
                        },
                        neckWidth: '30%',
                        neckHeight: '25%',
                        point: {
                            events: {
                                click: function () {
                                    var Name = this.name;
                                    $.each(datas, function () {
                                        if (this.text == Name) {
                                            var url = '/Form/EditForm/c869aac0-31ac-4260-817b-b61308022705/?FollowStatus=' + this.id + '&Nofilter=true&Lcd=' + currentplan;
                                            mini.open({ url: url, width: "80%", heigth: "160%" });
                                            //window.open(url);
                                            return false;
                                        }

                                    })


                                }
                            }
                        }
                    }
                },
                legend: {
                    enabled: false
                },
                series: [{
                    name: '金额',
                    data: data2
                }]
            });

        }
        function OpenWizard(e, callback) {
            mini.open({
                url: e.url,
                width: "80%", height: "80%", title: e.title,
                showMaxButton: true,
                onload: function () {
                    var iframe = this.getIFrameEl();
                    var winpar = iframe.contentWindow.WizardParams;
                    if (winpar && e.multi) {
                        winpar.multi = e.multi;
                    }
                    var selobj = iframe.contentWindow.Select;
                    if (selobj) {
                        if (selobj.SetWhere && e.swhere) selobj.SetWhere(e.swhere);
                        if (selobj.LoadStepFirst) selobj.LoadStepFirst();
                    }
                },
                ondestroy: function (action) {
                    if (action != "ok") return;
                    var iframe = this.getIFrameEl();
                    var data = null;
                    if (iframe.contentWindow.Select)
                        data = iframe.contentWindow.Select.GetData();
                    else {
                        if (iframe.contentWindow.GetData)
                            data = iframe.contentWindow.GetData();
                    }
                    data = mini.clone(data);
                    if (data) {
                        if (callback) callback(data);
                    }
                }
            });
        }



        //渲染图表
        function InitEChart(chartid, option) {
            require.config({
                paths: {
                    echarts: '/Scripts/plugins/echarts/'
                }
            });
            require([
                'echarts',
                'echarts/theme/default',
                'echarts/chart/line',   // 按需加载所需图表，如需动态类型切换功能，别忘了同时加载相应图表
                'echarts/chart/bar',
				'echarts/chart/funnel',
				'echarts/chart/pie'
            ], function (ec, theme) {
                var myChart = ec.init(document.getElementById(chartid), theme);
                myChart.setOption(option);
                myChart.on('click', function (param) {
                    var url = "/Form/EditForm/149e6b66-99ba-41d5-b008-cee8c5baf658/"
                    //if (Types == "Amount") {

                    if (typeof param.seriesIndex != 'undefined') {
                        var tesxt = param.seriesName;
                        var Datad = param.name;
                        var Datads = Datad.replace(/\s+/g, "");
                        var StartDate = Datads + '-1';
                        var data = new Date(StartDate);
                        var year = data.getFullYear();
                        var month = data.getMonth() + 1;
                        var enddata = new Date(year, month, 0);
                        var EndDate = enddata.getFullYear() + '-' + (enddata.getMonth() + 1) + '-' + enddata.getDate();
                        var ContractType = null;
                        for (var key in typeData) {
                            if (typeData[key] == tesxt) {
                                ContractType = encodeURI(encodeURI(key));
                            }
                        }
                        if (!ContractType) {
                            return false;
                        }
                        url += "?ContractType=" + ContractType + "&StartDate=" + StartDate + "&EndDate=" + EndDate;
                        window.open(url);
                    }

                    //}
                    //if (Types == "Distribute") {

                    //    //getFormValue
                    //    if (typeof param.seriesIndex != 'undefined') {

                    //        var tesxt = param.name;
                    //        var Times = mini.get("QStartDate").getValue();
                    //        var StartDate = Times.getFullYear() + "-1-1";   //本年第一天
                    //        var EndDate = Times.getFullYear() + "-12-31";

                    //        if (chartid == 'Charts1') {
                    //            var ContractType = null;
                    //            var ContractType = JBaseData("PS_ContractType", tesxt)
                    //            ContractType = encodeURI(encodeURI(ContractType));
                    //            if (!ContractType) {
                    //                return false;
                    //            }
                    //            url += "?ContractType=" + ContractType + "&StartDate=" + StartDate + "&EndDate=" + EndDate;

                    //        } else {

                    //            var ProductType = JBaseData("PS_ProductType", tesxt)//
                    //            ProductType = encodeURI(encodeURI(ProductType));
                    //            if (!ProductType) {
                    //                return false;
                    //            }
                    //            url += "?ProductType=" + ProductType + "&StartDate=" + StartDate + "&EndDate=" + EndDate;

                    //        }
                    //        window.open(url);
                    //    }

                    //}

                });
            })
        }

        function JBaseData(DataType, tesxt) {
            var CType = null;
            var p = {};
            p.DataType = DataType;
            $.ajax({
                url: "/Data/JBaseData",
                async: false,
                data: p,
                type: "POST",
                success: function (text) {
                    var list = mini.decode(text);
                    $.each(list, function () {
                        if (this.text == tesxt) {
                            CType = this.id;
                            CType = encodeURI(encodeURI(CType));

                        }
                    })
                }
            });
            return CType;
        }

    </script>
</body>
</html>
