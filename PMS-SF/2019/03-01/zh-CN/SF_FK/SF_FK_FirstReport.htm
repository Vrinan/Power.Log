<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <script src="/Scripts/boot.js?v=$AppVersion" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/ComTools.js?v=$AppVersion" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/WebForm.js?v=$AppVersion" type="text/javascript"></script>
    <!--<script src="/PowerPlat/WorkFlow/js/FlowStatusSeries.js?v=$AppVersion" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/WorkFlowForm.js?v=$AppVersion" type="text/javascript"></script>-->
    <script src="/Form/Init/$Model.data.FormId/$Model.data.FormState/$Model.data.KeyValue"></script>
    <script language="javascript" src="/Scripts/PlatForm/ControlCenter.js?v=$AppVersion "></script>
    <script language="javascript" src="/Scripts/PlatForm/WorkFlowsEnums.js?v=$AppVersion "></script>
    <script language="javascript" src="/Scripts/PlatForm/WorkFlowsForm.js?v=$AppVersion "></script>
    <script type="text/javascript" hasvelocity="true">
        var KeyValue = "$Model.data.KeyValue";
        var FormId = "$Model.data.FormId";
        var FormState = "$Model.data.FormState";
        var currentproj = "$!CurrentSession.EpsProjId";
    </script>
</head>

<body>
    <div class="row" style="height: 100%">
        <div class="portlet box blue" style="height: 100%">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-reorder"></i>分包结算审批
                </div>
                $!WorkFlowButtons
                <div class="actions">
                    <div class="btn-group">

                        <!--<a class="mini-button blue" id="btnActive" onclick="WorkFlowUtils.ActiveWorkFlow(this)" style="display:none"><i class="fa fa-save"></i>送审</a>-->
                        <!--<a class="mini-button blue" id="SF_FK_FirstReport.ViewForm" onclick="ViewForm()">
                        <i class="fa fa-eye"></i>查看</a>
                        <div id="btnPrint" class="btn-group"></div>-->
                        <div id="btnPrint" class="btn-group"></div>

                        <a class="mini-button blue" id="SF_FK_FirstReport.Save" onclick="PowerForm.OnBtnSave(this)">
                            <i class="fa fa-save"></i>保存
                        </a>
                        <a class="mini-button blue" id="SF_FK_FirstReport.Refresh" onclick="PowerForm.OnBtnRefresh(this)">
                            <i class="fa fa-refresh"></i>刷新
                        </a>
                        <a class="mini-button blue" id="SF_FK_FirstReport.CloseForm" onclick="PowerForm.OnBtnCloseForm(this)">
                            <i class="fa fa-power-off"></i>关闭
                        </a>
                    </div>
                </div>
            </div>
            <div class="mini-fit">
                <div class="portlet-body" style="height: 100%;">
                    <div id="maintabs" class="mini-tabs" tabposition="left" tabalign="left" style="height: 100%;">
                        <div title='基本信息'>
                            <!--通常-->
                            <div id="SF_FK_FirstReport" class="form">
                                <!--class=""-->
                                <table class="table table-bordered">
                                    <tr>
                                        <td>
                                            编号
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.Code" name="Code" class="mini-textbox" required="true" />
                                        </td>
                                        <td>
                                            状态
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.Status" name="Status" class="mini-combobox" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            工程名称
                                        </td>
                                        <td colspan="3">
                                            <input id="SF_FK_FirstReport.Title" name="Title" textname="Title" class="mini-buttonedit" emptytext="请选择名称..." onbuttonclick="PowerForm.OnBtnWizard(this)"
                                                required="true" allowinput="false" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            结算类型
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.OverType" name="OverType" class="mini-combobox"  required/>
                                        </td>
                                        <td>
                                            建设地址
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.Address" name="Address" class="mini-textbox" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            承包人名称
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.ContractorName" name="ContractorName" class="mini-textbox" />
                                        </td>
                                        <td>
                                            分包人名称
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.SubcontractorName" name="SubcontractorName" class="mini-textbox" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            报审结算造价(小写）
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.Report" name="Report" class="mini-spinner" onvaluechanged="ReportToA" allowlimitvalue="false"
                                                format="n2" />
                                        </td>
                                        <td>
                                            报审结算造价(大写）
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.ReportA" name="ReportA" class="mini-textbox" allowlimitvalue="false" allowinput="false" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            审定结算造价(小写）
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.Trial" name="Trial" class="mini-spinner" onvaluechanged="TrialToA" allowlimitvalue="false" format="n2"
                                            />
                                        </td>
                                        <td>
                                            审定结算造价(大写）
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.TrialA" name="TrialA" class="mini-textbox" allowlimitvalue="false" format="n2" allowinput="false"
                                            />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            审定增/减结算造价(小写）
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.DifferencePrice" name="DifferencePrice" class="mini-spinner" onvaluechanged="DifferToA" allowlimitvalue="false"
                                                format="n2" />
                                        </td>
                                        <td>
                                            审定增/减结算造价(大写）
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.DifferencePriceA" name="DifferencePriceA" class="mini-textbox" allowlimitvalue="false" format="n2"
                                                allowinput="false" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            备注
                                        </td>
                                        <td colspan="3">
                                            <input id="SF_FK_FirstReport.Memo" name="Memo" class="mini-textarea" allowlimitvalue="false" />
                                        </td>
                                    </tr>

                                    </tr>


                                    <tr>
                                        <td>
                                            录入人
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.RegHumName" name="RegHumName" class="mini-textbox" readonly="readonly" />
                                        </td>
                                        <td>
                                            录入时间
                                        </td>
                                        <td>
                                            <input id="SF_FK_FirstReport.RegDate" name="RegDate" class="mini-datepicker" readonly="readonly" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div title="附件" name="attachfile" url=""></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        mini.parse();
        var PowerForm = new WebForm();
        $(function () {
            PowerForm.Init();
        });

        PowerForm.EventAfterFormLoad = function (e,data) {
            if (FormState == "add") {
                mini.get("SF_FK_FirstReport.ReportA").setValue("零元整");
                mini.get("SF_FK_FirstReport.TrialA").setValue("零元整");
                mini.get("SF_FK_FirstReport.DifferencePriceA").setValue("零元整");
            }
        }
        function ReportToA(e) {

            var ReportA = Arabia_to_Chinese(e.value + "");
            mini.get("SF_FK_FirstReport.ReportA").setValue(ReportA);


            var Trial = mini.get("SF_FK_FirstReport.Trial").getValue();
            var Report = mini.get("SF_FK_FirstReport.Report").getValue();
            if (Trial != undefined && Trial != null && Trial != 0) {
                mini.get("SF_FK_FirstReport.DifferencePrice").setValue(Report - Trial);
                mini.get("SF_FK_FirstReport.DifferencePriceA").setValue(Arabia_to_Chinese((Report - Trial) + ""));
            } else {
                mini.get("SF_FK_FirstReport.DifferencePrice").setValue(Report);
                mini.get("SF_FK_FirstReport.DifferencePriceA").setValue(Arabia_to_Chinese(Report + ""));
            }
        };
        function TrialToA(e) {


            var TrialA = Arabia_to_Chinese(e.value + "");
            mini.get("SF_FK_FirstReport.TrialA").setValue(TrialA);


            var Report = mini.get("SF_FK_FirstReport.Report").getValue();
            var Trial = mini.get("SF_FK_FirstReport.Trial").getValue();
            if (Report != undefined && Report != null && Report != 0) {
                mini.get("SF_FK_FirstReport.DifferencePrice").setValue(Report - Trial);
                mini.get("SF_FK_FirstReport.DifferencePriceA").setValue(Arabia_to_Chinese((Report - Trial) + ""));
            } else {
                Power.ui.warning("报审结算造价没填！");
            }

        };
        function DifferToA(e) {
            var DifferencePriceA = Arabia_to_Chinese(e.value + "");
            mini.get("SF_FK_FirstReport.DifferencePriceA").setValue(DifferencePriceA);

        };


        function Arabia_to_Chinese(Num) {
            
            for (i = Num.length - 1; i >= 0; i--) {
                Num = Num.replace(",", "")//替换tomoney()中的“,”
                Num = Num.replace(" ", "")//替换tomoney()中的空格
            }
            Num = Num.replace("￥", "")//替换掉可能出现的￥字符
            if (isNaN(Num)) { //验证输入的字符是否为数字
                alert("请检查小写金额是否正确");
                return;
            }
            //---字符处理完毕，开始转换，转换采用前后两部分分别转换---//
            part = String(Num).split(".");
            newchar = "";

            if(Num == 0)
            {
                newchar="零元整";
                return newchar;
            }
            else
            {
                //小数点前进行转化
            for (i = part[0].length - 1; i >= 0; i--) {
                if (part[0].length > 11) { alert("位数过大，无法计算"); return ""; } //若数量超过拾亿单位，提示
                tmpnewchar = ""
                perchar = part[0].charAt(i);
                switch (perchar) {
                    case "0": tmpnewchar = "零" + tmpnewchar; break;
                    case "1": tmpnewchar = "壹" + tmpnewchar; break;
                    case "2": tmpnewchar = "贰" + tmpnewchar; break;
                    case "3": tmpnewchar = "叁" + tmpnewchar; break;
                    case "4": tmpnewchar = "肆" + tmpnewchar; break;
                    case "5": tmpnewchar = "伍" + tmpnewchar; break;
                    case "6": tmpnewchar = "陆" + tmpnewchar; break;
                    case "7": tmpnewchar = "柒" + tmpnewchar; break;
                    case "8": tmpnewchar = "捌" + tmpnewchar; break;
                    case "9": tmpnewchar = "玖" + tmpnewchar; break;
                }
                switch (part[0].length - i - 1) {
                    case 0: tmpnewchar = tmpnewchar + "元"; break;
                    case 1: if (perchar != 0) tmpnewchar = tmpnewchar + "拾"; break;
                    case 2: if (perchar != 0) tmpnewchar = tmpnewchar + "佰"; break;
                    case 3: if (perchar != 0) tmpnewchar = tmpnewchar + "仟"; break;
                    case 4: tmpnewchar = tmpnewchar + "万"; break;
                    case 5: if (perchar != 0) tmpnewchar = tmpnewchar + "拾"; break;
                    case 6: if (perchar != 0) tmpnewchar = tmpnewchar + "佰"; break;
                    case 7: if (perchar != 0) tmpnewchar = tmpnewchar + "仟"; break;
                    case 8: tmpnewchar = tmpnewchar + "亿"; break;
                    case 9: tmpnewchar = tmpnewchar + "拾"; break;
                    case 10: tmpnewchar = tmpnewchar + "佰"; break;
                    case 11: tmpnewchar = tmpnewchar + "仟"; break;
                }
                newchar = tmpnewchar + newchar;
            }
            //小数点之后进行转化
            if (Num.indexOf(".") != -1) {
                if (part[1].length > 2) {
                    alert("小数点之后只能保留两位,系统将自动截段");
                    part[1] = part[1].substr(0, 2)
                }
                for (i = 0; i < part[1].length; i++) {
                    tmpnewchar = ""
                    perchar = part[1].charAt(i)
                    switch (perchar) {
                        case "0": tmpnewchar = "零" + tmpnewchar; break;
                        case "1": tmpnewchar = "壹" + tmpnewchar; break;
                        case "2": tmpnewchar = "贰" + tmpnewchar; break;
                        case "3": tmpnewchar = "叁" + tmpnewchar; break;
                        case "4": tmpnewchar = "肆" + tmpnewchar; break;
                        case "5": tmpnewchar = "伍" + tmpnewchar; break;
                        case "6": tmpnewchar = "陆" + tmpnewchar; break;
                        case "7": tmpnewchar = "柒" + tmpnewchar; break;
                        case "8": tmpnewchar = "捌" + tmpnewchar; break;
                        case "9": tmpnewchar = "玖" + tmpnewchar; break;
                    }
                    if (i == 0) tmpnewchar = tmpnewchar + "角";
                    if (i == 1) tmpnewchar = tmpnewchar + "分";
                    newchar = newchar + tmpnewchar;
                }
            }
            //替换所有无用汉字
            while (newchar.search("零零") != -1)
                newchar = newchar.replace("零零", "零");
            newchar = newchar.replace("零亿", "亿");
            newchar = newchar.replace("亿万", "亿");
            newchar = newchar.replace("零万", "万");
            newchar = newchar.replace("零元", "元");
            newchar = newchar.replace("零角", "");
            newchar = newchar.replace("零分", "");
            if (newchar.charAt(newchar.length - 1) == "元" || newchar.charAt(newchar.length - 1) == "角")
                newchar = newchar + "整"
            //  document.write(newchar);
            return newchar;
            }
        }

        //关联查看
        // function ViewForm() {
        //     var id = formconfig.config.joindata.currow["Id"];

        //     var InvestorId = mini.get("SF_FK_FirstReport.BusinessTravelId").getValue();

        //     if (formconfig.FormState == "add" || mini.get("SF_FK_FirstReport.BusinessTravelCode").value == "") {
        //         return;
        //     }
        //     else {
        //         var url = "/Form/ValidForm/dc42c961-fbc6-4344-a3e3-4f6602be1684/" + "/view/" + InvestorId;
        //         mini.open({
        //             url: url,
        //             width: 900,
        //             height: 550
        // });

        //     }
        // }
    </script>
</body>

</html>