<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no,maximum-scale=1.0">
    <title> 16市场信息列表 </title>
    <link href="../global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css" />
    <link href="../global/plugins/icon-font-alibaba/iconfont.css" rel="stylesheet" type="text/css" />
    <link href="../global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="../global/plugins/jquery.mobile/jquery.mobile.structure-1.4.5.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="../global/css/common.css" type="text/css">
</head>

<body>

    <!-- Tab panes -->
    <!--tab content主体内容  --开始-->
    <section class="contract-body-content">
        <div class="container">
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="receivingNode" data-btns="yes">
                    <ul id="receiveNode" class="receive-node-content">

                    </ul>


                    <div class="receiving-node-checkAll-delete clearFix" style="display: none;">
                        <div class="receiving-box receiving-node-checkAll-box">
                            <span class="delete-all font-color-blue"> 全部选中 </span>
                        </div>

                        <div class="receiving-box receiving-node-delete-box">
                            <span class="delete-check"> 删除 </span>
                        </div>
                    </div>

                </div>
            </div>

            <div class="btn-bottom-groups">
                <div class="btn-control-content receivingNode-control">
                    <div class="btn-box-content">
                        <div class="btn-box">
                            <p> <i class="icon iconfont icon-add1 font-color-red"> </i> </p>
                            <p> <span class="font-control">  新增 </span> </p>
                        </div>
                    </div>
                    <div class="btn-box-content" id="eventsDelete">
                        <div class="btn-box">
                            <p> <i class="icon iconfont icon-delete font-color-purple"> </i> </p>
                            <p> <span class="font-control">  删除 </span> </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!--tab content主体内容  --结束-->



    <script src="../global/plugins/jquery.min.js" type="text/javascript"></script>
    <script src="../global/plugins/jquery.mobile/jquery.mobile-1.4.5.min.js" type="text/javascript"></script>
    <script src="../global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../global/plugins/slider-pro-master/js/jquery.sliderPro.min.js" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/ComTools.js"></script>
    <script src="/Apps/Common.js"></script>

    <script type="text/javascript">
        $(function() {
            var contractDetails = {
                init: function() {
                    this.events();
                },
                nodeTemplate: function(data, Id) {
                    if (data && data.length > 0) {
                        var list, i = 0,
                            html = '';
                        for (; i < data.length; i++) {
                            list = data[i];
                            html += '<li>' +
                                '<div class="receive-node receive-node-checkbox">' +
                                '<div class="receive-node-checkbox-check">' +
                                '<div class="icon-content">' +
                                '<i class="icon iconfont checkContent"> </i>' +
                                '</div>' +
                                '</div>' +
                                '</div>' +
                                '<div class="receive-node receive-node-main">' +
                                '<p class="receive-line receive-node-title">' +
                                '<i class="icon iconfont icon-xingyeshichang font-color-blue"></i>' +
                                '<span class="list-name">' + list.Name + '</span>' +
                                '<i class="icon iconfont icon-more node-more">  </i>' +
                                '</p>' +
                                '<p class="receive-line receive-node-details">' +
                                '<span> ' + list.NodeType + ' </span>' +
                                '<span> ' + list.Sum + ' </span>' +
                                '<span> ' + list.RegDate + ' </span>' +
                                '</p>' +
                                '</div>' +
                                '</li>';
                        }

                        $("#" + Id).html(html);
                    }
                },
                accessoryTemplate: function(data, Id) {
                    if (data && data.length > 0) {
                        var list, i = 0,
                            html = '';
                        for (; i < data.length; i++) {
                            list = data[i];
                            html += '<li  data-id="' + list.Id + '">' +
                                '<a href="">' +
                                '<i class="icon iconfont icon-attachment font-color-blue"></i>' +
                                '<span class="attachmentName"> ' + list.Name + ' </span>' +
                                '</a>' +
                                '<span class="floatRight"> ' + list.RegDate + ' </span>' +
                                '</li>';
                        }

                        $("#" + Id).html(html);
                    }
                },

                openWebForm: function(formid, keyvalue) {

                    // var url = "/Form/ValidForm/" + formid + "/edit/" + keyvalue + "/";
                    //eventsListDetail.html是一个表单模板 由于需要配置文件，需要后端配合
                    var url = "/Apps/Apps2.0/assets/html/eventsListDetail.html";
                    CallAppFunction("appOpenNewWebView", '{"url":"' +
                        url + '","pullUp":"false","pullDown":"false","showTabbar":"false","title":""}', url);
                },
                events: function() {
                    //获取数据
                    var getNodeData = [{
                        "Name": "中国石油天然气股份有限公司华北石化分公司1",
                        "NodeType": "张杰",
                        "Sum": "1000万",
                        "RegDate": "2017-05-18"
                    }, {
                        "Name": "中国石油天然气股份有限公司华北石化分公司2",
                        "NodeType": "张杰",
                        "Sum": "1000万",
                        "RegDate": "2017-05-18"
                    }, {
                        "Name": "中国石油天然气股份有限公司华北石化分公司3",
                        "NodeType": "张杰",
                        "Sum": "1000万",
                        "RegDate": "2017-05-18"
                    }, {
                        "Name": "中国石油天然气股份有限公司华北石化分公司4",
                        "NodeType": "张杰",
                        "Sum": "1000万",
                        "RegDate": "2017-05-18"
                    }];

                    this.nodeTemplate(getNodeData, "receiveNode");

                    var openWebForm = this.openWebForm;
                    var tapMain = $("#receivingNode");
                    //实现长时间触摸显示选中框
                    $("#eventsDelete").on("click", function() {
                        tapMain.attr("data-btns", "no");
                        tapMain.find("ul.receive-node-content").addClass("tapHoldEvent");

                        $(".receiving-node-checkAll-delete").show();
                        $(this).closest(".btn-bottom-groups").hide();
                    });

                    //实现选中的样式添加（对号）
                    $(".delete-all").on("click", function() {
                        $(this).toggleClass("checkCancel");
                        if ($(this).hasClass("checkCancel")) {
                            $(this).text("取消全选");

                            tapMain.find("i.checkContent").addClass("icon-tongyi")
                                .closest("li").addClass("checkTrue");
                        } else {
                            $(this).text("全部选中");
                            tapMain.find("i.checkContent").removeClass("icon-tongyi")
                                .closest("li").removeClass("checkTrue");
                            tapMain.find("ul.receive-node-content").removeClass("tapHoldEvent");
                            $(this).closest("div.receiving-node-checkAll-delete").hide();
                            $(".btn-bottom-groups").show();
                        }
                    });

                    //实现选中的样式添加（对号）
                    tapMain.on("click", ".receive-node-checkbox-check", function() {
                        $(this).find("i").toggleClass("icon-tongyi");
                        $(this).closest("li").toggleClass("checkTrue");

                        var checkLis = tapMain.find("li.checkTrue");
                        var tapLis = tapMain.find("li");

                        if (checkLis.length == tapLis.length) {
                            $(".delete-all").addClass("checkCancel").text("取消全选");
                        } else {
                            $(".delete-all").removeClass("checkCancel").text("全部选中");
                        }
                    });

                    //删除选中
                    $(".delete-check").on("click", function() {
                        $("#receivingNode").find("li.checkTrue").remove();
                        tapMain.find("ul.receive-node-content").removeClass("tapHoldEvent");
                        $(this).closest("div.receiving-node-checkAll-delete").hide();
                        $(".btn-bottom-groups").show();
                        $(".delete-all").removeClass("checkCancel").text("全部选中");
                    });

                    $("#receiveNode li").on("click", function() {
                        openWebForm();
                    });

                }
            };

            contractDetails.init();
        });
    </script>
</body>

</html>