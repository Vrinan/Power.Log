<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title></title>
<meta name="keywords" content="">
<meta name="description" content="">
<meta name="viewport"  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<meta name="apple-mobile-web-app-capable"  content="yes" />
<meta name="apple-mobile-web-app-status-bar-style"  content="black" />
<meta name="format-detection"  content="no" />
<script src="/Apps/js/jquery-1.8.3.min.js"></script>
<script src="/Scripts/PlatForm/ComTools.js"></script>

<script src="/Apps/Common.js"></script>
<script src="/Apps/js/TouchSlide.1.1.js"></script>

<link href="style/style.css" rel="stylesheet" type="text/css" />
<link href="style/font-awesome.min.css" rel="stylesheet" type="text/css" />

</head>

<body>
<style type="text/css">
	.slideBox .hd1 ul{
		display:none;
	}
	.slideBox .bd1 img{
		width:100%;
		height:200px;
	}
	.slideBox .hd1 .pageState{
		position:absolute;
		bottom:0px;
		right:10px;
		color:#fff;
	}
	
	.problem-content .problem-title{
		background-color:#fff;
	}
	.problem-content .problem-title h3{
		line-height:45px;
		margin:0 10px;
		font-size:1.8rem;
		letter-spacing:1px;
		border-bottom:1px solid #dedede;
		background-color:#fff;
	}
	.problem-content .item-list{
		text-align:center;
		padding:10px 0px;
	}
	.problem-content .item-list span{
		width:100px;
		display:inline-block;
		line-height:20px;
		font-size:1.5rem;
		font-weight:500;
	}
	.red{
		color:#f00;
	}
	.problem-content .problem-title .item-list:after{
		content:'';
		display:block;
		clear:both;
	}
	.problem-content .problem-body{
		margin-top:10px;
		background-color:#fff;
		padding:5px 10px;
		line-height:25px;
		font-size:1.2rem;
	}
	.problem-content .problem-body img{
		width:50px;
		height:50px;
		border-radius:25px;
		float:left;
		margin-top:5px;
	}
	.problem-content .problem-body-list p span:nth-child(1){
		color:#999;
	}
	.problem-content .problem-body h3{
		border-bottom:1px solid #dedede;
		line-height:30px;
	}
	.problem-content .problem-body ul li{
		padding:5px 0px;
		border-bottom:1px dashed #dedede;
	}
	.problem-content .problem-body ul li .word{
		margin-left:60px;
	}
	.problem-content .problem-body ul li .name{
		color:#999;
		font-size:1.1rem;
	}
	.problem-content .problem-body ul li .date{
		float:right;
		color:#999;
		font-size:1.1rem;
	}
	.problem-content .problem-body ul li .comment{
		float:left;
		line-height:20px;
		padding:4px 0px;
		font-size:1.2rem;
	}
	.problem-content .problem-body ul li:after{
		content:'';
		display:block;
		clear:both;
	}
</style>
	
    <div id="slideBox" class="slideBox">
        <div class="bd1">
            <ul id="pic">
                <li><a href="#"><img src="images/banner404.jpg"></a></li>
                
            </ul>
        </div>
        <div class="hd1">
			<ul></ul>
			<span class="pageState"></span>
		</div>
    </div>

	<div class="problem-content"> 
		<div class="problem-title">
			<h3 id="Title"></h3>
			<ul class="item-list">
				<li><span>问题等级</span><span>优先级</span><span>问题状态</span></li>
				<li class="red"><span id="IssueLevel"></span><span id="IssuePriority"></span><span id="IssueStatus"></span></li>
			</ul>		
		</div>
		<div class="problem-body problem-body-list">
			<p><span>项目名称：</span><span id="OwnProjName"></span></p>			
			<p><span>责任人：</span><span id="AppointHuman"></span></p>
			<p><span>问题描述：</span><span id="IssueText"></span></p>
		</div>
		<div id='Contentcomment' class="problem-body">
			<h3>评论区</h3>
			<ul Id="comment">
				<li>
				</li>
				<li>
				</li>
				<li>
				</li>
				
				<!--<li>
					<div class="image"><img src="images/sample-4.jpg"/></div>
					<div class="word">
						<span class="name">用户名</span>
						<span class="date">38秒前评论</span>
						</br>
						<p class="comment">啊哈哈哈哈哈啊哈哈哈哈哈啊哈哈哈哈哈啊aa哈哈哈aa哈哈啊哈哈哈哈哈</p>
					</div>
				</li>
				<li>
					<div class="image"><img src="images/sample-4.jpg"/></div>
					<div class="word">
						<span class="name">用户名</span>
						<span class="date">38秒前评论</span>
						</br>
						<p class="comment">啊哈哈哈哈哈啊哈哈哈哈哈啊哈哈哈哈哈啊aa哈哈哈aa哈哈啊哈哈哈哈哈</p>
					</div>
				</li>
				<li>
					<div class="image"><img src="images/sample-4.jpg"/></div>
					<div class="word">
						<span class="name">用户名</span>
						<span class="date">38秒前评论</span>
						</br>
						<p class="comment">啊哈哈哈哈哈啊哈哈哈哈哈啊哈哈哈哈哈啊aa哈哈哈aa哈哈啊哈哈哈哈哈</p>
					</div>
				</li>-->
			</ul>
		</div>
	</div>
		<script type="text/javascript">
			 TouchSlide({
				slideCell:"#slideBox",
				titCell:".hd1 ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
				mainCell:".bd1 ul",
				effect:"leftLoop",
				autoPage:true,//自动分页
				autoPlay:true //自动播放
			});
			$(function () {
				var keyvalue = getParameter("keyvalue");
				var EpsProjId=getParameter("EpsProjId");						
				var params = new Object();
				params.KeyWord = "PS_ProjectIssue";
				params.KeyWordType = "BO";
				params.keyvalue = keyvalue;
				params.select = "";
				params.formstate = "view";
				$.ajax({
                url: "/Form/FormLoad",
                data:  params,
                type: "POST",
                success: function (text) {
						 var o = jQuery.parseJSON(text);
						if (o.success) {
							LoadFrom(o.data.value);
						}
					   
					}
				});
				var p = { KeyWord: "DocFile", KeyWordType: 'BO', select: '',index: 0, size: 0,sort: '' };
				p.swhere = "BOKeyWord = 'PS_ProjectIssue' AND FolderId = '"+keyvalue+"' and EpsProjId='"+EpsProjId+"'";				
				$.ajax({
					url: "/Form/GridPageLoadEx",
					data: p ,
					type: "POST",
					success: function (text) {
					   var o = jQuery.parseJSON(text);
						if (o.success) {
						  LoadPic(o.data.value)
						}
					   
					}
				});
			  $.ajax({
                url: "/Form/GetComment",
                data: { KeyWord: "PS_ProjectIssue", KeyValue: keyvalue },
                type: "POST",
                success: function (text) {
                   var o = jQuery.parseJSON(text);
                    if (o.success) {
                       if(o.data.value.length==0){
					    $("#Contentcomment").hide(); return false;
					   }
					    
                       
						
                        var shtml = "";
						
                        for (var i = 0; i < o.data.value.length; i++) {
                            var r = o.data.value[i];
                               shtml = shtml + ToHtml(r.RegHumId, r.RegHumName, r.RegDate, r.RegHeader, r.AtHumanList, r.CommentText);
                        }
						var commentlist = document.getElementById('comment');
                        commentlist.innerHTML = shtml;
                    }
                   
                }
            });
			})
			function LoadPic(data){
			
			 data = jQuery.parseJSON(data);
			   if (data) {
							
                            var html = '';							
                            for (var i = 0; i < data.length; i++) {
								if(data[i].FileExt==".jpg"||data[i].FileExt==".gif"||data[i].FileExt==".jpg")
									html += ' <li><a href="#"><img style="height:155px;width:100%" src="/PowerPlat/Control/File.ashx?action=browser&_type=ftp&_fileid=' + data[i].Id + '"></a></li>';

                            }
							
                            $("#pic").html(html);

                            TouchSlide({
                                slideCell: "#slideBox",
                                titCell: ".hd1 ul", //开启自动分页 autoPage:true ，此时设置 titCell 为导航元素包裹层
                                mainCell: ".bd1 ul",
                                effect: "leftLoop",
                                autoPage: true,//自动分页
                                autoPlay: true //自动播放
                            });
                 }
			}
			function LoadFrom(data){
				data = jQuery.parseJSON(data);
				$("#Title").html(data.Title);
				$("#OwnProjName").html(data.OwnProjName);
				$("#AppointHuman").html(data.AppointHuman);
				$("#IssueText").html(data.IssueText);
				var lv='';
				if (data.IssueLevel=="1")
					lv="一般";
				if (data.IssueLevel=="2")
					lv="中等";
				if (data.IssueLevel=="3")
					lv="严重";
				$("#IssueLevel").html(lv); 
				var ip="";
				if (data.IssuePriority=="I1")
					ip="低";
				if (data.IssuePriority=="I2")
					ip="中";
				if (data.IssuePriority=="I3")
					ip="高";
				$("#IssuePriority").html(ip); 
				var ss="";
				if (data.IssueStatus=="01")
					ss="新增";
				if (data.IssueStatus=="02")
					ss="解决中";
				if (data.IssueStatus=="03")
					ss="已解决";
				$("#IssueStatus").html(ss); 
			}
			 function ToHtml(reghumid, reghumname, regdate, regheader, atlist, commenttext) {
				var hums = "";
				if (atlist && atlist.length > 0) {
					for (var i = 0; i < atlist.length; i++) {
						var h = atlist[i];
						hums = hums + '<a href="javascript:;" >@' + h.HumanName + "</a> ";
					}
				}
				var time="";
				if (typeof (regdate.Format) == "function")
                                time = regdate.Format("yyyy-MM-dd");
                            else
                                time = regdate.toString().split('T')[0];
				var html='<li><div class="image"><img src="'+regheader+'"/></div>'+
					'<div class="word">'+
						'<span class="name">'+reghumname+'</span>'+
						'<span class="date">'+time+'</span>'+
						'</br>'+
						'<p class="comment">' + hums + commenttext+'</p>'+
					'</div>'+
				  ' </li>';
				
				return html;
        }
		</script>
		
		
</body>