webpackJsonp([27],{"5LcD":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("3cXf"),i=s.n(a),o=s("aA9S"),n=s.n(o),r=s("4YfN"),c=s.n(r),l=s("9rMa"),u=s("N8Hv"),h=s("GUsc"),d=s("RAwi"),f=s("CKVb"),v={name:"workflow",data:function(){return{query:{},formState:"",methods:[{text:"串行",Code:"Serial",checked:!1},{text:"并行",Code:"Parallel",checked:!1}],currentMethod:"",MindInfo:"",Current:{},delegateItem:{},HistoryMind:[],UserList:[],defaultUserList:[],RootUserInfo:{},backToRoot:!1,positionUserParams:{}}},mounted:function(){this.getDelegateData()},methods:c()({submitData:function(){var t=this,e=this.validSubmitData();if(!e.isPass)return this.AlertShowEvent(e.msg),!1;var s=n()({},{Current:this.Current,FlowOperate:"Delegate",MindInfo:this.MindInfo,Mode:{DelegateMode:this.currentMethod,IsReturnRoot:this.backToRoot},VoteText:"",VoteValue:""});this.FlowActionData(i()(s)).then(function(e){t.ToastShowEvent("完成提交"),t.GetInformCount().then(function(){t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){"view"===t.formState?t.$router.push("/workinfos"):t.$router.back()},1e3)}).catch(function(e){t.AlertShowEvent(e.message)})}).catch(function(e){t.AlertShowEvent(e.message)})},validSubmitData:function(){var t={msg:"",isPass:!0};return""===this.MindInfo?(t.msg="意见不能为空",t.isPass=!1,t):""===this.currentMethod?(t.msg="请选择委派模式",t.isPass=!1,t):0===this.defaultUserList.length?(t.msg="请选择委派人员",t.isPass=!1,t):t},openUsersBlock:function(){this.$refs.positionUserList.load()},getDelegateData:function(){var t=this;this.getQuery();var e=n()({},{SubOperate:"ReadDelegateUsers",FlowOperate:"SupplyInstance",Current:this.query});this.FlowActionData(i()(e)).then(function(e){var s=e.data.value;t.Current=n()({},s.Current),t.HistoryMind=s.HistoryMind.concat(),s.DelegateItem&&(t.delegateItem=n()({},s.DelegateItem),t.delegateItem=n()({},s.DelegateItem),t.RootUserInfo=t.delegateItem.RootUserInfo,t.defaultUserList=t.delegateItem.UserList.concat(),t.UserList=[t.RootUserInfo].concat(t.delegateItem.UserList),t.organizeData())}).catch(function(e){t.AlertShowEvent(e.message)})},completeSelectUsers:function(t){var e=this,s=t.map(function(t,e){return delete t.isBootLast,t}),a=n()({},{SubOperate:"SaveUserToDelegate",FlowOperate:"SupplyInstance",DelegateItem:{RootSequeID:this.Current.SequeID,UserList:s},Current:n()({},this.Current)});this.FlowActionData(i()(a)).then(function(){e.getDelegateData()}).catch(function(t){e.AlertShowEvent(t.message)})},backToRootEvent:function(){if("Parallel"===this.currentMethod)return this.AlertShowEvent("并行必须选择返回发起人"),!1;this.backToRoot=!this.backToRoot,this.defaultUserList.length>0&&this.formatUserList()},formatUserList:function(t){var e=this,s=n()({},this.RootUserInfo),a=n()({},this.RootUserInfo),i=this.delegateItem.UserList||[];t&&(i=i.concat(t)),this.backToRoot?(this.UserList=[s].concat(i,[a]),this.UserList.forEach(function(t,s){s===e.UserList.length-1?t.isBootLast=!0:t.isBootLast=!1})):(this.UserList=[s].concat(i),this.UserList.forEach(function(t,e){t.isBootLast=!1}))},switchMethod:function(t){this.currentMethod=t.Code,this.methodAndbackRoot()},methodAndbackRoot:function(){"Parallel"===this.currentMethod&&(this.backToRoot=!0)},organizeData:function(){var t=this.delegateItem;this.currentMethod=t.DelegateMode,this.methodAndbackRoot(),this.formatUserList()},goBack:function(){this.$router.back()},getQuery:function(){var t=this.$router.history.current.query;t&&(this.query=n()({},t),this.formState=this.query.FormState)}},Object(l.b)(["GetInformCount","FlowActionData","AlertShowEvent","ToastShowEvent"])),destroyed:function(){this.timer&&clearTimeout(this.timer)},components:{CheckIcon:u.default,XTextarea:d.a,Group:f.a,PositionUserList:h.a}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{attrs:{name:"slide"}},[s("div",{staticClass:"work-flow-delegate"},[s("div",{staticClass:"flow-delegate-content"},[s("div",{staticClass:"delegate-method"},[s("h1",{staticClass:"title font-color-active"},[t._v("委派模式:")]),t._v(" "),s("ul",{staticClass:"method-lists"},t._l(t.methods,function(e,a){return s("li",{key:a,staticClass:"method-list",on:{click:function(s){t.switchMethod(e)}}},[s("div",{staticClass:"methid-list-inner"},[s("div",{staticClass:"text"},[t._v("\n                "+t._s(e.text)+"\n              ")]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:e.Code===t.currentMethod}})],1)])])})),t._v(" "),s("div",{staticClass:"back-to-active"},[s("h1",{staticClass:"title font-color-active"},[t._v("是否返还给发起人:")]),t._v(" "),s("div",{staticClass:"back-to-content",on:{click:t.backToRootEvent}},[s("div",{staticClass:"text"},[t._v("\n              是否返还给发起人\n            ")]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:t.backToRoot}})],1)])])]),t._v(" "),s("div",{staticClass:"user-content"},[s("h1",{staticClass:"title font-color-active"},[s("div",{staticClass:"text"},[t._v("人员列表:")]),t._v(" "),s("div",{staticClass:"btn",on:{click:t.openUsersBlock}},[t._v("选择人员")])]),t._v(" "),s("ul",{staticClass:"user-lists"},t._l(t.UserList,function(e,a){return t.UserList.length>0?s("li",{key:a,staticClass:"user-list"},[0!==a||e.isBootLast?t._e():s("div",{staticClass:"list-inner"},[s("span",{staticClass:"name font-color-active"},[t._v(t._s(e.UserName))]),t._v(" "),s("span",{staticClass:"text"},[s("i",{staticClass:"fa fa-angle-double-right"})])]),t._v(" "),0===a||e.isBootLast?t._e():s("div",{staticClass:"list-inner"},[s("span",{staticClass:"text"},[s("i",{staticClass:"fa fa-angle-double-right"})]),t._v(" "),s("span",{staticClass:"name font-color-active"},[t._v(t._s(e.UserName))]),t._v(" "),"Serial"===t.currentMethod&&a!==t.UserList.length-1?s("span",{staticClass:"text"},[s("i",{staticClass:"fa fa-angle-double-right"})]):t._e()]),t._v(" "),a==t.UserList.length-1&&e.isBootLast?s("div",{staticClass:"list-inner"},[s("span",{staticClass:"text"},[s("i",{staticClass:"fa fa-angle-double-right"})]),t._v(" "),s("span",{staticClass:"name font-color-active"},[t._v(t._s(e.UserName))])]):t._e()]):t._e()}))]),t._v(" "),s("div",{staticClass:"mond-info-content"},[s("h1",{staticClass:"title font-color-active"},[t._v("提交意见:")]),t._v(" "),s("group",{staticClass:"textarea-content"},[s("x-textarea",{attrs:{name:"description",max:300,placeholder:"输入办理意见"},model:{value:t.MindInfo,callback:function(e){t.MindInfo="string"==typeof e?e.trim():e},expression:"MindInfo"}})],1)],1)]),t._v(" "),s("div",{staticClass:"flow-delegate-footer"},[s("div",{staticClass:"item",on:{click:t.submitData}},[t._v("\n        提交\n      ")]),t._v(" "),s("div",{staticClass:"item",on:{click:t.goBack}},[t._v("\n        返回\n      ")])]),t._v(" "),s("position-user-list",{ref:"positionUserList",attrs:{subParams:t.positionUserParams,currentUserList:t.defaultUserList},on:{complete:t.completeSelectUsers}})],1)])},staticRenderFns:[]};var g=s("C7Lr")(v,m,!1,function(t){s("FfJg")},null,null);e.default=g.exports},FfJg:function(t,e){}});
//# sourceMappingURL=27.41ebf29fe35001610d39.js.map