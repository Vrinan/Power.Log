webpackJsonp([16],{mVYI:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("3cXf"),i=s.n(n),c=s("aA9S"),o=s.n(c),a=s("4YfN"),r=s.n(a),d=s("9rMa"),u=s("tiSE"),h=s("N8Hv"),l=s("RAwi"),f=s("CKVb"),v={name:"workflow",data:function(){return{query:{},formState:"",method:[{text:"正常驳回",Code:"Normal",checked:!0},{text:"直接送还本节点(点对点)",Code:"MustSendCurrent",checked:!1},{text:"正常驳回，且收件人只能常规发送",Code:"MustReturnAndNormal",checked:!1}],NextNodeList:[],HistoryMind:[],MindInfo:"",Current:{}}},mounted:function(){this.getReturnData()},methods:r()({submitData:function(){var t=this,e=this.MindInfo,s=this.getSelectedNodeData(),n=this.valiData(e,s);if(!n.pass)return this.AlertShowEvent(n.msg),n.pass;var c=o()({},{FlowOperate:"Return",Current:this.Current,MindInfo:this.MindInfo,SelectedNode:s.concat()});this.FlowActionData(i()(c)).then(function(e){t.ToastShowEvent("驳回成功"),t.GetInformCount().then(function(){t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){"view"===t.formState?t.$router.push("/workinfos"):t.$router.back()},1e3)}).catch(function(e){t.AlertShowEvent(e.message)})}).catch(function(e){t.AlertShowEvent(e.message)})},valiData:function(t,e){var s={msg:"",pass:!0};return t&&""!==t?e&&0!==e.length?(e.forEach(function(t,e){var n=t.ItemList;if(!n||0===n.length)return s.msg="人员节点列不能为空",s.pass=!1,s;n.forEach(function(t,e){var n=t.UserList;if(!n||0===n.length)return s.msg="选择人员不能为空",s.pass=!1,s})}),s):(s.msg="人员节点不能为空",s.pass=!1,s):(s.msg="意见不能为空",s.pass=!1,s)},getSelectedNodeData:function(){var t=this,e=[];return this.NextNodeList.concat().forEach(function(s,n){var i={};s.checked&&(i.NodeCode=s.NodeCode,i.NodeName=s.NodeName,i.ReturnedSendMode=t.getSelectedMethod(),i.ItemList=[],s.ItemList.forEach(function(t,e){var s=t.UserList,n=o()({},t);n.UserList=[],n.OtherUserList=[],s.forEach(function(t,e){var s=o()({},t);t.checked&&(delete s.checked,n.UserList.push(s))}),i.ItemList.push(n)}),e.push(i))}),e},getSelectedMethod:function(){for(var t=this.method,e="Normal",s=0;s<t;s++)if(t[s].checked){e=t[s].Code;break}return e},getReturnData:function(){var t=this;this.getQuery();var e=o()({},{SubOperate:"ReadReturnNodeList",SequeID:this.query.SequeID,FlowOperate:"SupplyInstance",Current:this.query});this.FlowActionData(i()(e)).then(function(e){var s=e.data.value,n=s.NextNodeList.concat();t.Current=o()({},s.Current),t.NextNodeList=t.formatNextNodeList(n),t.HistoryMind=s.HistoryMind.concat()}).catch(function(e){t.AlertShowEvent(e.message)})},switchMethods:function(t){this.method.forEach(function(e,s){e.checked=s===t})},formatNextNodeList:function(t){return t.forEach(function(e,s){1===t.length?e.checked=!0:e.checked=!1,e.ItemList.forEach(function(t,s){var n=t.UserList;n.forEach(function(t,s){e.checked&&1===n.length?t.checked=!0:t.checked=!1})})}),t},selectedUser:function(t,e,s){var n=this.NextNodeList.concat();n[t].ItemList[e].UserList[s].checked=!n[t].ItemList[e].UserList[s].checked,this.NextNodeList=n.concat()},selectedNodeEvent:function(t){var e=this.NextNodeList.concat();e[t].checked=!e[t].checked,e[t].checked?e[t].ItemList[0].UserList.forEach(function(s){var n=e[t].ItemList[0].UserList.length;s.checked=1===n}):e[t].ItemList[0].UserList.forEach(function(t){t.checked=!1}),this.NextNodeList=e.concat()},goBack:function(){this.$router.back()},getQuery:function(){var t=this.$router.history.current.query;t&&(this.query=o()({},t),this.formState=this.query.FormState)}},Object(d.b)(["GetInformCount","FlowActionData","AlertShowEvent","ToastShowEvent"])),components:{LineBreak:u.default,CheckIcon:h.default,XTextarea:l.a,Group:f.a}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{attrs:{name:"slide"}},[s("div",{staticClass:"work-flow-return"},[s("div",{staticClass:"flow-return-content"},[s("div",{staticClass:"return-content"},[s("h1",{staticClass:"title font-color-active"},[t._v("人员选择:")]),t._v(" "),t._l(t.NextNodeList,function(e,n){return s("div",{key:n,staticClass:"return-user-row"},[s("h1",{staticClass:"row-title",on:{click:function(e){t.selectedNodeEvent(n)}}},[s("div",{staticClass:"text font-color-active"},[t._v(t._s(e.NodeName))]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:e.checked}})],1)]),t._v(" "),t._l(e.ItemList,function(e,i){return s("ul",{key:i,staticClass:"row-lists"},t._l(e.UserList,function(e,c){return s("li",{key:c,staticClass:"row-list",on:{click:function(e){t.selectedUser(n,i,c)}}},[s("div",{staticClass:"row-list-inner"},[s("div",{staticClass:"text"},[t._v(t._s(e.UserName))]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:e.checked}})],1)])])}))})],2)})],2),t._v(" "),s("div",{staticClass:"method-content"},[s("h1",{staticClass:"title font-color-active"},[t._v("发送模式:")]),t._v(" "),s("ul",{staticClass:"method-lists"},t._l(t.method,function(e,n){return s("li",{key:n,staticClass:"method-list",on:{click:function(e){t.switchMethods(n)}}},[s("div",{staticClass:"list-inner"},[s("div",{staticClass:"text"},[t._v("\n                "+t._s(e.text)+"\n              ")]),t._v(" "),s("div",{staticClass:"icon"},[s("check-icon",{attrs:{checked:e.checked}})],1)])])}))]),t._v(" "),s("div",{staticClass:"mind-info-content"},[s("h1",{staticClass:"title font-color-active"},[t._v("提交意见:")]),t._v(" "),s("group",{staticClass:"textarea-content"},[s("x-textarea",{attrs:{name:"description",max:300,placeholder:"输入驳回意见"},model:{value:t.MindInfo,callback:function(e){t.MindInfo="string"==typeof e?e.trim():e},expression:"MindInfo"}})],1)],1)]),t._v(" "),s("div",{staticClass:"flow-return-footer"},[s("div",{staticClass:"item",on:{click:t.submitData}},[t._v("\n        提交\n      ")]),t._v(" "),s("div",{staticClass:"item",on:{click:t.goBack}},[t._v("\n        返回\n      ")])])])])},staticRenderFns:[]};var k=s("C7Lr")(v,m,!1,function(t){s("yw/E")},null,null);e.default=k.exports},"yw/E":function(t,e){}});
//# sourceMappingURL=16.6ee75ad58a9c03f9fed0.js.map