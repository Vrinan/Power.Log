
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <script src="/Scripts/boot.js?v=697" type="text/javascript"></script>
    <script src="/Scripts/plugins/echarts/source/echarts.js" type="text/javascript"></script>
    <script src="/Form/Init/$Model.data.FormId/$Model.data.FormState/$Model.data.KeyValue"></script>

    <style>
        body {
            background: #f5f5f5 !important;
        }

        .page-top .page-tops,
        .page-bottom .page-bottoms {
            float: left;
        }

        .page-lump .times {
            display: inline-block;
            float: right;
            color: #949090;
        }

        .page-tops.page-top-left ul li,
        .page-tops.page-top-right ul li,
        .page-bottoms.page-bottom-right ul li {
            /*border-bottom: 1px solid #ddd;*/
            line-height: 29px;
        }

        .page-center {
            text-align: center;
            line-height: 40px;
            color: #444;
            font-weight: 600;
            font-size: 16px;
        }

            .page-center span:last-child {
                padding-left: 10px;
            }

        .page-lump-box {
            padding: 5px;
        }

        .tube-map-box {
            border-radius: 5px;
            height: calc(100% - 40px);
        }

        .title-box {
            height: 20px;
            line-height: 20px;
        }

            .title-box .title-left {
                font-size: 14px;
                font-weight: 600;
            }

            .title-box .title-right {
                display: inline-block;
                float: right;
                cursor: pointer;
            }

        .text,
        .planBox {
            height: 90%;
            overflow: hidden;
        }

        .page-lump {
            border: 1px solid #ddd;
            background: #fff !important;
            padding: 10px 20px;
        }

        .proj_mess {
            height: 30px;
            line-height: 30px;
        }

        .timeline {
            padding-left: 5px;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 10px;
        }

        .timeline-axis {
            position: absolute;
            left: -3px;
            top: 8px;
            z-index: 10;
            width: 17px;
            height: 17px;
            line-height: 20px;
            background-color: #fff;
            color: #5FB878;
            border-radius: 50%;
            text-align: center
        }

            .timeline-axis:hover {
                color: #FF5722;
            }

        .icon.timeline-axis {
            background: url('/PowerPlat/FormXml/zh-CN/StdPortalManage/image/circle.png') no-repeat 50% 50%;
        }

        .timeline-item:before {
            content: '';
            position: absolute;
            left: 5px;
            top: 0;
            z-index: 0;
            width: 1px;
            height: 100%;
            background-color: #e3e3e3;
        }

        .timeline-item:last-child:before {
            display: block;
        }

        .timeline-item:first-child:before {
            display: block;
        }

        .timeline-content {
            padding-left: 25px;
        }

        .timeline-title {
            position: relative;
            margin-bottom: 10px;
        }


        .caption {
            font-size: 14px !important;
            font-weight: bold !important;
        }

        .detail {
            line-height: 32px;
            height: 32px;
        }

            .detail.center {
                font-size: 17px;
            }

        .detail-right {
            float: right;
        }

            .detail-right span {
                font-weight: bold !important;
            }

        .portlet {
            border-radius: 2px;
        }

        .portlet-title,
        .portlet-body {
            padding: 0 10px !important;
            border-radius: 0 !important;
            background-color: transparent !important;
            color: #fff !important;
        }

        .b-orange {
            background: url('/PowerPlat/FormXml/zh-CN/StdPortalManage/image/orange.png') no-repeat 50% 50%;
        }

        .b-blue {
            background: url('/PowerPlat/FormXml/zh-CN/StdPortalManage/image/blue.png') no-repeat 50% 50%;
        }

        .b-green {
            background: url('/PowerPlat/FormXml/zh-CN/StdPortalManage/image/green.png') no-repeat 50% 50%;
        }

        .modal-dialog {
            width: 1000px;
        }



        *::-webkit-scrollbar {
            width: 8px;
            background-color: #fff;
        }

        *::-webkit-scrollbar-thumb {
            background-color: #ddd;
            border-radius: 8px;
            -webkit-box-shadow: inset 0 0 6px rgba(255, 255, 255, .3);
        }

        .button-title{
            margin-top: 5px;
        }
        .button-title li{
            border: 1px solid #ddd;
            border-radius: 3px;
            padding: 0px 6px;
            margin-left: 5px;
            height: 25px;
            line-height: 25px;
            float: left;
            font-size: 12px;
            cursor: pointer;
            text-align: center;
        }
        .button-title li.active {
            border: 1px solid #75B2FF;
            background: #75B2FF;
            color: #fff;
        }
        .clearfix:after{
            content:".";
            display:block;
            clear:both;
            height: 0;
            visibility:hidden
        }
        .clearfix{
            zoom: 1;
        }


    </style>
</head>
<body>
    <div class="page-top" style="width:100%;height:100%;">
        <div class="page-tops page-top-left" style="width:35%;height:100%;">
            <div class="page-lump-box" style="width:100%;height:50%;">
                <div class="page-lump" style="width:100%;height:100%;">
                    <div style="width:100%;height:100%;">
                        <div class="title-box">
                            <span class="title-left">审批分类</span>
                        </div>
                        <ul class="button-title clearfix">
                            <li href="/Form/EditForm/c12bf916-fc2f-4ebf-8c31-fc9557f90b09/">
                                <a href="/Form/EditForm/c12bf916-fc2f-4ebf-8c31-fc9557f90b09/" style="color:#666">行政</a>
                            </li>
                            <li href="/Form/EditForm/3fda1044-2126-4410-863e-02a7cb820e39/">
                                <a href="/Form/EditForm/3fda1044-2126-4410-863e-02a7cb820e39/" style="color:#666">项目</a>
                            </li>
                        </ul>
                        <div id="chartA" style="width:100%;height:100%;">
                                
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-lump-box" style="width:100%;height:50%;">
                <div class="page-lump" style="width:100%;height:100%;padding:10px 20px;">
                    <div style="width:100%;height:100%;overflow:auto">
                        <div class="title-box">
                            <!-- <span class="title-left">我的审批</span>
                            <div class="">
                                <a href="/Form/EditForm/93086420-7fde-42f4-8b4f-f6e16e9dec51/" style="color:#666"><i class="fa fa-bars"></i>更多</a>
                            </div>  -->
                            <div class="caption">
                                <i class="fa fa-calendar"></i>我的审批
                            </div>
                            <div class="caption right" style="float: right">
                                <a href="/Form/EditForm/2b9a8adb-121e-40e7-ab4a-52d05806c548/2b9a8adb-121e-40e7-ab4a-52d05806c548/" style="color:#666"><i class="fa fa-bars"></i>更多</a>
                            </div>
    
                            <iframe style='width:100%;height:240px;' frameborder='0' src='/Form/EditForm/C18537D6-C6B6-4563-84BD-C4842AD08C7A/'></iframe>
                        </div>

                    </div>
                </div>
            </div>
        </div>
        <div class="page-tops page-top-right" style="width:65%;height:100%;">
            <div class="page-lump-box" style="width:100%;height:102px;padding-left:0">
                <div class="col-sm-4 col-md-4 col-lg-4">
                    <div class="portlet box b-blue">
                        <div class="portlet-title">
                            <div class="caption">
                                    <i class="fa  fa-send"></i>
                                在建项目
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="detail">
                                <div>
                                    本年
                                    <span class="detail-right">
                                        <span id='Ycount'></span>个
                                    </span>
                                </div>
                            </div>
                            <div class="detail">
                                <div>
                                    本月
                                    <span class="detail-right">
                                        <span id='Mcount'></span>个
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="col-sm-4 col-md-4 col-lg-4">
                    <div class="portlet box b-green">
                        <div class="portlet-title">
                            <div class="caption">
                                    <i class="fa  fa-calendar"></i>
                                新签合同
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="detail">
                                <div>
                                    本年
                                    <span class="detail-center">
                                        <span id="a1"></span>个
                                    </span>
                                    <span class="detail-right">
                                            ￥<span id="a2"></span>
                                    </span>
                                </div>
                            </div>
                            <div class="detail">
                                <div>
                                    本月
                                    <span class="detail-center">
                                            <span id="a5"></span>个
                                    </span>
                                    <span class="detail-right">
                                            ￥<span id="a6"></span>
                                    </span>
                                    
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-sm-4 col-md-4 col-lg-4">
                    <div class="portlet box b-orange">
                        <div class="portlet-title">
                            <div class="caption">
                                <i class="fa  fa-home"></i>
                                产值
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="detail">
                                <div>
                                    本年
                                    <span class="detail-right">￥<span id="bc1"></span></span>
                                </div>
                            </div>
                            <div class="detail">
                                <div>
                                    本月
                                    <span class="detail-right">￥<span id="bc3"></span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="page-lump-box" style="width:100%;height:calc(50% - 51px);">
                <div class="page-lump" style="width:100%;height:100%;padding:10px 20px;">
                    <div style="width:100%;height:100%;">
                        <div class="title-box">
                            <span class="title-left">年度合同支付统计</span>
                        </div>
                        <div id="chart1" class="echarts" style="width:100%; height:90%"></div>
                    </div>
                </div>
            </div>
            <div class="page-lump-box" style="width:100%;height:calc(50% - 51px);">
                <div class="page-tops page-top-left" style="width:65%;height:100%;padding-right:10px">
                    <div class="page-lump" style="width:100%;height:100%;padding:10px 20px;">
                        <div style="width:100%;height:100%;">
                            <div class="title-box">
                                <span class="title-left">项目质量统计</span>
                            </div>
                            <div class="col-sm-4 col-md-4 col-lg-4" style="height:100%">
                                <div id="chart2" class="echarts" style="width:100%; height:90%"></div>
                            </div>
                            <div class="col-sm-4 col-md-4 col-lg-4" style="height:100%">
                                <div id="chart3" class="echarts" style="width:100%; height:90%"></div>
                            </div>
                            <div class="col-sm-4 col-md-4 col-lg-4" style="height:100%">
                                <div id="chart4" class="echarts" style="width:100%; height:90%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-tops page-top-right" style="width:35%;height:100%;">
                    <div class="page-lump" style="width:100%;height:100%;padding:10px 20px;">
                        <div style="width:100%;height:100%;">
                            <div class="title-box">
                                <span class="title-left">项目质量统计</span>
                            </div>
                            <div id="chart5" class="echarts" style="width:100%; height:90%"></div>

                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

</body>
</html>
<script>
    //最上面三个框
    $.ajax({
        url: "/ALLZ/GetAnalysis2",
        data: {humanid : sessiondata.HumanId},
        type: "POST",
        success: function (text) {
            var o = mini.decode(text);
            if (o.success) {
                var data = o.data;
                if(sessiondata.HumanName=="系统管理员")
                {
                    $("#Ycount").append(data.Ycount);
                    $("#a2").append(0);
                    $("#a6").append(0);
                }
                else
                {
                    $("#Ycount").append(data.rtProjNO);
                }
              
                //$("#Ycount").append(data.Ycount);
                $("#Mcount").append(data.Mcount);
                $("#a1").append(data.a1);
                $("#a2").append(data.a2);
                $("#a5").append(data.a5);
                $("#a6").append(data.a6);
                var bc1 = data.bc1.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                $("#bc1").append(bc1);
                var bc3 = data.bc3.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
                $("#bc3").append(bc3);
                
            }
        }
    });

    //审批分类

    $.ajax({
        url: "/ALLZ/GetWorkflowAmount",
        data: {humanid : sessiondata.HumanId},
        type: "POST",
        success: function (text) {
            var o = mini.decode(text);
            if (o.success) {
                if(o.data.Re1 == 0 && o.data.Re2 == 0)
                {
                    $("#chartA").append('<span style="position: relative;left:150px;top:100px;">暂无待审批</span');
                }
                else
                {
                    LoadchartA(o.data);
                }
            }
        }
    });
    function LoadchartA(data){
        var optionA = {
            color: [ '#33BF73', '#FFC000', '#9FD7FB'],
            tooltip: {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c}"
            },
            calculable: false,
            series: [
                {
                    name: '审批分类',
                    type: 'pie',
                    radius: '55%',
                    center: ['50%', '40%'],
                    data: [
                        { value: data.Re1, name: '行政审批' },
                        { value: data.Re2, name: '项目审批' }
                    ],
                    itemStyle: {
                        normal: {
                            label: {
                                show: true,
                                formatter: '{b} \n{c}个'
                            },
                            labelLine: { show: true }
                        }
                    }
                }
            ]
        };
        InitEChartbar("chartA", optionA);
    }
        //渲染图表
        function InitEChartbar(chartid, option) {

            require.config({
                paths: {
                    echarts: '/Scripts/plugins/echarts/'
                }
            });
            require([
                'echarts',
                'echarts/theme/default',
                'echarts/chart/line',   // 按需加载所需图表，如需动态类型切换功能  ，别忘了同时加载相应图表
                'echarts/chart/bar',
                'echarts/chart/pie',
                'echarts/chart/gauge'

            ], function (ec) {
                var myChart = ec.init(document.getElementById(chartid));
                $(window).resize(function () {
                    myChart.resize();
                });
                myChart.setOption(option);
                myChart.on('click', function(param) {
                    //console.log(param);
                    var url = param.data.url;
                    if(param.data.name=="行政审批")
                    {
                        OnViewForm1();
                    }
                    else
                    {
                        OnViewForm2();
                    }
                });
            })
        }

        function OnViewForm1() {
            mini.open({
                url: '/Form/EditForm/c12bf916-fc2f-4ebf-8c31-fc9557f90b09/',
                showMaxButton: true,
                width: 1200,
                height: 800,
                ondestroy: function () {
                    window.location.href="/WebCenter/MainMenu/bbbbbbbb-0000-0000-0000-000000000000";
                }
            })
        }
        function OnViewForm2() {
            mini.open({
                url: '/Form/EditForm/3fda1044-2126-4410-863e-02a7cb820e39/',
                showMaxButton: true,
                width: 1200,
                height: 800,
                ondestroy: function () {
                    window.location.href="/WebCenter/MainMenu/bbbbbbbb-0000-0000-0000-000000000000";
                }
            })
        }


    //合同柱形图
    $.ajax({
        url: "/ALLZ/GetContractAmount",
        data: {},
        type: "POST",
        success: function (text) {
            var o = mini.decode(text);
            if (o.success) {
                Loadchart1(o.data);
            }
        }
    });
    function Loadchart1(data){
        var i =1;
        var option1 = {
            grid: {
                borderWidth: 0,
                x: 80,
                x2: 10,
                y: 20,
                y2: 20
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {            // 坐标轴指示器，坐标轴触发有效
                    type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
                },
            },
            legend: {
                data: ['批准金额', '拟付金额']
            },

            calculable: true,
            xAxis: [
                {
                    splitLine: { show: false },//去除网格线
                    type: 'category',
                    data: data.Array1
                }
            ],
            yAxis: [
                {
                    type: 'value'
                }
            ],
            series: [
                {
                    name: '批准金额',
                    type: 'bar',
                    itemStyle: {
                        normal: {
                            color: '#53acff'

                        }
                    },
                    data: data.Array3,
                },
                {
                    name: '拟付金额',
                    type: 'bar',
                    itemStyle: {
                        normal: {
                            color: '#bfdbf4'
                        }
                    },
                    data: data.Array2,
                }
            ]
        };
        InitEChart("chart1", option1);
    }
    
    var option2 = {
        title: {
            text: '问题整改率',
            x: 'center',
            y: 'bottom',
            textStyle: {
                fontSize: 12,
            }
        },
        color: ['#55c6de', '#c5ccd8'],
        series: [
            {
                type: 'pie',
                radius: ['50%', '70%'],
                itemStyle: {
                    normal: {
                        label: {
                            show: true,
                            position: 'center',
                            textStyle: {
                                color: "#444",
                            }
                        },
                        labelLine: {
                            show: false
                        },
                    }
                },
                data: [
                    { value: 200, name: "67%" },
                    { value: 100 }
                ]
            }
        ]
    };
    var option3= {
        title: {
            text: '验收一次合格率',
            x: 'center',
            y: 'bottom',
            textStyle: {
                fontSize: 12,
            }
        },
        color: ['#4aceb7', '#c5ccd8'],
        series: [
            {
                type: 'pie',
                radius: ['50%', '70%'],
                itemStyle: {
                    normal: {
                        label: {
                            show: true,
                            position: 'center',
                            textStyle: {
                                color: "#444",
                            }
                        },
                        labelLine: {
                            show: false
                        }
                    },
                },
                data: [
                    { value: 100, name: "24%" },
                    { value: 310 },
                ]
            }
        ]
    };
    var option4 = {
        title: {
            text: '验收合格率',
            x: 'center',
            y: 'bottom',
            textStyle: {
                fontSize: 12,
            }
        },
        color: ['#7460ee', '#c5ccd8'],
        series: [
            {
                type: 'pie',
                radius: ['50%', '70%'],

                itemStyle: {
                    normal: {
                        label: {
                            show: true,
                            position: 'center',
                            textStyle: {
                                color: "#444",
                            }

                        },
                        labelLine: {
                            show: false
                        }
                    },

                },
                data: [
                    { value: 335, name: "52%" },
                    { value: 310 },

                ]
            }
        ]
    };
    var option5 = {
        calculable: false,
        color: ['#5E5999', '#54BCD7', '#F5D858', '#9ACB68', "#808080"],
        tooltip: {
            trigger: 'item',
            formatter: "{b} <br/>  {c} ({d}%)"
        },
        series: [
            {
                name: '访问来源',
                type: 'pie',
                radius: [30, 55],

                center: ['50%', '50%'],
                itemStyle: {
                    normal: {
                        labelLine: {
                            length: 1

                        }
                    }
                },
                data: [
                    { value: 335, name: '集团' },
                    { value: 310, name: '一分公司' },
                    { value: 234, name: '二分公司' },
                    { value: 135, name: '三分公司' },
                    { value: 233, name: '四分公司' }
                ]
            }
        ]
    };

    //渲染图表
    function InitEChart(chartid, option) {
        require.config({
            paths: {
                echarts: '/Scripts/plugins/echarts/'
            }
        });
        require([
            'echarts',
            'echarts/theme/default',
            'echarts/chart/line',   // 按需加载所需图表，如需动态类型切换功能  ，别忘了同时加载相应图表
            'echarts/chart/bar',
            'echarts/chart/pie',
            'echarts/chart/gauge'
        ], function (ec) {
            var myChart = ec.init(document.getElementById(chartid));
            $(window).resize(function () {
                myChart.resize();
            });
            myChart.setOption(option);

        })
    }
    $(function () {
        InitEChart("chart2", option2);
        InitEChart("chart3", option3);
        InitEChart("chart4", option4);
        InitEChart("chart5", option5);
    })
</script>