<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title></title>
    <script src="/Scripts/boot.js?version=<%=AppVersion%>" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/ComTools.js?version=<%=AppVersion%>" type="text/javascript"></script>
    <script src="/PowerPlat/WorkFlow/js/FlowStatusSeries.js?version=<%=AppVersion%>"
            type="text/javascript"></script>
    <script src="/Scripts/PlatForm/WebForm.js?version=<%=AppVersion%>" type="text/javascript"></script>
    <script src="/Scripts/PlatForm/WorkFlowForm.js?version=<%=AppVersion%>" type="text/javascript"></script>
    <script src="/Form/Init/$Model.data.FormId/$Model.data.FormState/$Model.data.KeyValue"></script>
    <script type="text/javascript" hasvelocity="true">
        var KeyValue = "$Model.data.KeyValue";
        var FormId = "$Model.data.FormId";
        var FormState = "$Model.data.FormState";
    </script>
</head>
<body>
    <div class="row" style="height: 100%">
        <div class="portlet box blue" style="height: 100%">
            <div class="portlet-title">
                <div class="caption">
                    <i class="fa fa-reorder"></i><span>物资采购合同登记</span>
                </div>
                <div class="actions">
                    <a class="mini-button blue" id="ZhContactDetails.Effect" onclick="PowerForm.OnBtnEffect(this);" style="display: none"><i class="fa fa-save"></i>生效 </a>
                    <a class="mini-button blue" id="ZhContactDetails.UnEffect" onclick="PowerForm.OnBtnUnEffect(this);" style="display: none"><i class="fa fa-save"></i>取消生效</a>
                    <!--                    <a class="mini-button blue" id="btnActive" onclick="WorkFlowUtils.ActiveWorkFlow(this);"style="display: none"><i class="fa fa-save"></i>送审 </a>-->
                    <a class="mini-button blue" id="ZhContactDetails.Save" onclick="PowerForm.OnBtnSave(this)"><i class="fa fa-save"></i>保存 </a>
                    <a class="mini-button blue" id="ZhContactDetails.Refresh" onclick="PowerForm.OnBtnRefresh(this)"><i class="fa fa-refresh"></i>刷新 </a>
                    <!--<a class="mini-button blue" id="ZhContactDetails.Print"><i class="fa fa-print"></i>打印 </a>-->
                    <a class="mini-button blue" id="ZhContactDetails.CloseForm" onclick="PowerForm.OnBtnCloseForm(this)"><i class="fa fa-power-off"></i>关闭</a>
                </div>
            </div>
            <!--portlet-body-->
            <div class="mini-fit">
                <div class="portlet-body" style="height: 100%;">
                    <div class="mini-tabs" id="maintabs" tabposition="left" tabalign="left" style="height: 100%;">
                        <!--tab 通常 -->
                        <div title="通常" style="text-align: left;" concls="fa fa-h-square">
                            <div id="ZhContactDetails" class="form">
                                <table class="table table-bordered">
                                    <tr>
                                        <td>
                                            <label for="txttitle">
                                                项目编号
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.ProjectCode" name="ProjectCode" class="mini-textbox"
                                                   style="width: 100%" readonly />
                                            <input id="ZhContactDetails.ContractType" name="ContractType" class="mini-textbox"
                                                   style="display: none" readonly="readonly">
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                项目名称
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.ProjectName" name="ProjectName" class="mini-textbox"
                                                   style="width: 100%" readonly />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="FYKM_name">
                                                费用科目
                                            </label>
                                        </td>
                                        <td colspan="3">
                                            <input id="ZhContactDetails.FYKM_name" name="FYKM_name" textname="FYKM_name" class="mini-buttonedit"
                                                   onbuttonclick="PowerForm.OnBtnWizard(this)" allowinput="false" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="htps_name">
                                                对应合同评审
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.htps_name" name="htps_name" textname="htps_name" class="mini-buttonedit"
                                                   onbuttonclick="PowerForm.OnBtnWizard(this)" allowinput="false" />
                                            <input id="ZhContactDetails.htps_Id" name="htps_Id" textname="htps_name" class="mini-textbox"
                                                   style="width: 100%;display:none" />
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                合同号(C号)
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.HTCode" name="HTCode" class="mini-textbox" required style="width: 100%" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="txttitle">
                                                合同编号
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.Code" name="Code" class="mini-textbox" required
                                                   style="width: 100%" />
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                合同名称
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.Name" name="Name" class="mini-textbox" required
                                                   style="width: 100%" />
                                        </td>
                                    </tr>
									
                                    <tr>
                                        
                                        <td>
                                            <label for="lblCurrencyCode">
                                                合同主货币
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.CurrencyCode" name="CurrencyCode" class="mini-combobox" required />
                                        </td>
                                    </tr>
									<tr>
									   <td>税率</td>
									   <td><input id="ZhContactDetails.Tax" name="Tax" class="mini-combobox" required onvaluechanged="setTotal" /></td>
									   
									    <td>
                                              税额(万元)
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.TaxAmount" name="TaxAmount" class="mini-spinner" align="right" format="0.000000" changeonmousewheel="false" allowlimitvalue="false" readonly />
                                        </td>
									</tr>
									<tr>
									  <td>
                                            <label for="HtMoney">
                                                合同签订金额(万元)
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.HtMoney" name="HtMoney" maxValue="99999999999999" class="mini-spinner" vtype="float" format="0.000000" onvaluechanged="setBghMoney" readonly />
                                            <input id="ZhContactDetails.HtMoneys" name="HtMoneys" maxValue="99999999999999" class="mini-spinner" vtype="float" format="0.000000" readonly style="display:none" />
                                        </td>
										<td>不含税金额(万元)</td>
									   <td><input id="ZhContactDetails.TotalPriceTax" name="TotalPriceTax" class="mini-spinner" align="right" format="0.000000" changeonmousewheel="false" allowlimitvalue="false" readonly /></td>
									
									</tr>
                                    <tr>
                                        <td>
                                            <label for="ZbTotalMoney">
                                                合同变更金额(万元)
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.ZbTotalMoney" name="ZbTotalMoney" allowlimitvalue="false" maxValue="99999999999999" class="mini-spinner" format="0.000000" changeonmousewheel="false"
                                                   readonly="readonly" />
                                        </td>
                                        <td>
                                            <label for="TotalPrice">
                                                变更后合同总额(万元)
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.TotalPrice" name="TotalPrice" class="mini-spinner"maxValue="99999999999999" format="0.000000" readonly="readonly" />
                                        </td>
                                    </tr>
                                    <!--<tr>

                                        <td>
                                            <label for="WzContCode">
                                                所属主合同号
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.WzContCode" name="WzContCode" class="mini-textbox" />
                                        </td>
                                    </tr>-->
                                    <tr>
                                        <td>
                                            <label for="txtPartA">
                                                甲方
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.PartyAName" name="PartyAName" class="mini-textbox" style="width: 100%" />
                                            <!--<input id="ZhContactDetails.PartyAName" name="PartyAName" class="mini-buttonedit"
                                            textname="PartyAName" onbuttonclick="PowerForm.OnBtnWizard(this)"/>-->
                                            <input id="ZhContactDetails.PartyAId" name="PartyAId" class="mini-textbox" style="display: none;" />
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                甲方签署人
                                            </label>
                                        </td>
                                        <td>
                                            <!--<input id="ZhContactDetails.PartyASigner" name="PartyASigner" class="mini-buttonedit" textname="PartyASigner" onbuttonclick="PowerForm.OnBtnWizard(this)" />-->
                                            <input id="ZhContactDetails.PartyASigner" name="PartyASigner" class="mini-textbox" style="width: 100%" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <!--<td>
                                            <label for="PartyCode">
                                                乙方编码
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.PartyCode" name="PartyCode" textname="PartyCode" class="mini-textbox" />
                                        </td>-->
                                        <td>
                                            <label for="PartBName">
                                                乙方
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.PartyBName" name="PartyBName" width="80%" textname="PartyBName" class="mini-buttonedit"
                                                   onbuttonclick="PowerForm.OnBtnWizard(this)" allowinput="false" required/>
                                            <a class="mini-button blue" id="ViewFrom" onclick="ViewFrom()"><i class="fa fa-eye"></i><span style="color: #1c5aaf !important;">查看</span></a>
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                乙方签署人
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.PartyBSigner" name="PartyBSigner" class="mini-buttonedit" textname="PartyBSigner" onbuttonclick="PowerForm.OnBtnWizard(this)" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <!--<td>
                                            <label for="txttitle">
                                                固定汇率
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.ExchangeRate" name="ExchangeRate" class="mini-spinner"
                                                format="n" changeonmousewheel="false" allowlimitvalue="false" />
                                        </td>-->
                                        <td>
                                            <label for="BankType">
                                                开户银行
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.BankType" name="BankType" class="mini-textbox" required/>
                                        </td>
                                        <td>
                                            <label for="BankNum">
                                                开户账号
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.BankNum" name="BankNum" class="mini-textbox" required/>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="txtYF_phone">
                                                乙方联系电话
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.YF_phone" name="YF_phone" class="mini-textbox" required/>
                                        </td>
                                        <td>
                                            <label for="txtStatus">
                                                状态
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.Status" name="Status" class="mini-combobox" readonly />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="partnerCode">
                                                对应源合同编号
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.partnerCode" name="partnerCode" class="mini-buttonedit"
                                                   textname="partnerCode" onbuttonclick="PowerForm.OnBtnWizard(this)" />
                                        </td>
                                        <td>
                                            <label for="FkType">
                                                付款方式
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.FkType" name="FkType" class="mini-combobox" style="width: 100%" />
                                        </td>
                                    </tr>
                                    <!--<tr>
                                        <td>
                                            <label for="txttitle">
                                                合同签订日期
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.JudgeDate" name="JudgeDate" class="mini-datepicker" />
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                合同完工日期
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.FinishDate" name="FinishDate" class="mini-datepicker" />
                                        </td>
                                    </tr>-->
                                    <tr>
                                        <td>
                                            <label for="txttitle">
                                                合同签署日期
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.PartyASignDate" name="PartyASignDate" class="mini-datepicker" />
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                合同生效日期
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.EffectDate" name="EffectDate" class="mini-datepicker"
                                                   style="width: 100%" />
                                        </td>
                                    </tr>
                                    <!--<tr>
                                        <td>
                                            <label for="DDType">
                                                订单类型
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.DDType" name="DDType" class="mini-textbox" style="width: 100%" />
                                        </td>
                                        <td>
                                            <label for="ItemType">
                                                是否带采购合同
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.ItemType" name="ItemType" class="mini-combobox" style="width: 100%" />
                                        </td>
                                    </tr>-->
                                    <tr>

                                        <td>
                                            <label for="JhType">
                                                交货方式
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.JhType" name="JhType" class="mini-combobox" style="width: 100%" />
                                        </td>
                                        <td>
                                            <label for="YsType">
                                                运输方式
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.YsType" name="YsType" class="mini-combobox" style="width: 100%" />
                                        </td>
                                    </tr>
                                    <!--<tr>
                                        <td>
                                            <label for="TsYd">
                                                特殊约定
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.TsYd" name="TsYd" class="mini-textbox" />
                                        </td>
                                    </tr>-->
                                    <tr>
                                        <!--<td>
                                            <label for="BankName">
                                                开户名
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.BankName" name="BankName" class="mini-textbox" />
                                        </td>-->
                                        <!--<td>
                                            <label for="Hlyd">
                                                结算汇率约定
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.Hlyd" name="Hlyd" class="mini-combobox" style="width: 100%" />
                                        </td>-->
                                    </tr>
                                    <!--<tr>
                                        <td>
                                            <label for="BgBankName">
                                                变更开户名
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.BgBankName" name="BgBankName" class="mini-textbox" readonly="readonly" />
                                        </td>
                                        <td>
                                            <label for="BgBankType">
                                                变更开户行
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.BgBankType" name="BgBankType" class="mini-textbox" readonly="readonly" />
                                        </td>
                                    </tr>-->

                                    <tr>
                                        <td>
                                            <label for="txttitle">
                                                录入人
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.RegHumName" name="RegHumName" class="mini-textbox" readonly="True" />
                                        </td>
                                        <td>
                                            <label for="txttitle">
                                                录入日期
                                            </label>
                                        </td>
                                        <td>
                                            <input id="ZhContactDetails.RegDate" name="RegDate" class="mini-datepicker" readonly="True" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <label for="lblMemo">
                                                备注
                                            </label>
                                        </td>
                                        <td colspan="3">
                                            <input id="ZhContactDetails.Memo" name="Memo" class="mini-textarea" style="height: 60px" />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <!--tab 通常 end-->
                        <div title="内容">
                            <div class="mini-toolbar" id="Div5">
                                <a class="mini-button blue" id="ZhConstructionContractList.Add" onclick="PowerForm.OnBtnWizard(this)"><i class="fa fa-plus"></i>从采购文件选择</a>
                                <a class="mini-button blue" id="ZhConstructionContractList.Add1" onclick="PowerForm.OnBtnAdd(this)"><i class="fa fa-plus"></i>新增</a>
                                <a class="mini-button blue" id="ZhConstructionContractList.Save" onclick="PowerForm.OnBtnSave(this)" style=""><i class="fa fa-save"></i>保存</a>
                                <a class="mini-button blue" id="ZhConstructionContractList.Delete" onclick="PowerForm.OnBtnDel(this)"><i class="fa fa-trash-o"></i>删除</a>
                            </div>
                            <div class="mini-fit">
                                <div id="ZhConstructionContractList" class="mini-datagrid" style="width: 100%; height: 100%;" allowresize="true" allowcelledit="true" multiselect="true" allowcellselect="true" idfield="Id" showpager="true" oncellendedit="cellendedit">
                                    <div property="columns">
                                        <div type="indexcolumn" width="40">
                                            序号
                                        </div>
                                        <div field="MatBS_Code" headeralign="center" vtype="required" name="MatBS_Code" class="design mini-datagridcolumn" type="textboxcolumn">
                                            物资类别编码
                                            <input id="ZhConstructionContractList.MatBS_Code" property="editor" class="mini-buttonedit" onclick="PowerForm.OnBtnWizard(this)" style="width: 100%;" allowinput="flase" />
                                        </div>
                                        <div field="MatBS_Name" headeralign="center">
                                            物资类别名称
                                        </div>
                                        <div field="PiCode" headeralign="center">
                                            物资编码<input property="editor" class="mini-textbox" style="width: 100%;" textname="PiCode" />
                                        </div>
                                        <div field="PiName" headeralign="center">
                                            物资名称<input property="editor" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                        <div field="Sepc" headeralign="center">
                                            规格型号<input property="editor" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                        <div field="UnitName" type="comboboxcolumn" headeralign="center" align="center">
                                            计量单位<input property="editor" id="ZhConstructionContractList.UnitName" class="mini-combobox"
                                                       name="UnitName" url="/Form/ComboxLoadData/BD_Unit/" textfield="Name" valuefield="Code"
                                                       style="width: 100%;" allowInput="true" />
                                        </div>
                                        <div field="UnitPrice" headeralign="center" align="right" numberformat="0.000000">
                                            单价(万元)<input property="editor" class="mini-spinner" maxValue="99999999999999" style="width: 100%;" format="0.000000" changeonmousewheel="false"
                                                         allowlimitvalue="false" />
                                        </div>
                                        <div field="Amount" headeralign="center" align="right" numberformat="n2">
                                            数量<input property="editor" class="mini-spinner" maxValue="99999999999999" style="width: 100%;" format="0.000000" changeonmousewheel="false"
                                                     allowlimitvalue="false" />
                                        </div>
                                        <div field="TotalPrice" headeralign="center" align="right" numberformat="0.000000">
                                            金额(万元)<input property="editor" class="mini-spinner"  maxValue="99999999999999"style="width: 100%;" format="0.000000" changeonmousewheel="false"
                                                         allowlimitvalue="false" readonly="readonly" />
                                        </div>
                                        <div field="CurrencyCode" headeralign="center" align="center" type="comboboxcolumn">
                                            币种<input id="ZhConstructionContractList.CurrencyCode" property="editor" class="mini-combobox" style="width: 100%;" textfield="Name" valuefield="Code" />
                                        </div>
                                        <div field="ExchangeRate" headeralign="center" align="center" numberformat="n2">
                                            汇率
                                        </div>
                                        <div field="ZHUnitPrice" headeralign="center" align="right" numberformat="0.000000">
                                            折合主货币单价(万元)
                                        </div>
                                        <div field="ZHTotalPrice" headeralign="center" align="right" numberformat="0.000000">
                                            折合主货币金额(万元)
                                        </div>
                                        <!--div field="Taxrate" headeralign="center" align="right" nemberformat="n">税率<input property="editor" class="mini-spinner" style="width: 100%;" format="n" changeonmousewheel="false" allowlimitvalue="false"/></div-->
                                        <div field="Memo" headeralign="center" align="right">
                                            备注<input property="editor" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--tab 内容 end-->
                        <div title="合同变更" iconcls="fa fa-file-text">
                            <div class="portlet box blue" style="height: 100%">
                                <div class="portlet-title">
                                    <div class="captiontools">
                                        <a class="mini-button blue" id="ViewForm" onclick="ViewForm()"><i class="fa fa-plus"></i>查看</a>
                                    </div>
                                </div>
                                <div class="mini-fit">
                                    <div id="CGContractChange" class="mini-datagrid" style="width: 100%; height: 100%;"
                                         allowresize="true" allowcelledit="true" multiselect="true" allowcellselect="true"
                                         idfield="Id" showpager="true">
                                        <div property="columns">
                                            <div type="indexcolumn" headeralign="center" align="right" style="width: 100%;">
                                                序号
                                            </div>
                                            <div field="Code" headeralign="center" align="right">
                                                编号
                                            </div>
                                            <div field="Name" headeralign="center" align="right">
                                                名称
                                            </div>
                                            <div field="DateInco" headeralign="center" align="right" dateformat="yyyy-MM-dd">
                                                变更日期
                                            </div>
                                            <div field="CurCo" headeralign="center" align="right" numberformat="0.000000">
                                                变更金额(万元)<input property="editor" class="mini-spinner" style="width: 100%;" format="n"
                                                               changeonmousewheel="false" maxValue="99999999999999" allowlimitvalue="false" readonly="True" />
                                            </div>
                                            <div field="CoCompletDate" headeralign="center" align="right" dateformat="yyyy-MM-dd">
                                                变更完成时间
                                            </div>
                                            <div type="comboboxcolumn" field="CurrencyCode" headeralign="center" align="right">
                                                币种<input property="editor" class="mini-combobox" url="/Form/ComboxLoadData/BD_Currency/" textfield="Name"
                                                         valuefield="Code" style="width: 100%;" />
                                            </div>
                                            <div field="JudgeDate" headeralign="center" align="right" dateformat="yyyy-MM-dd">
                                                审定时间
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--tab 内容 end-->
                        </div>
                        <div title="付款明细" style="text-align: left;" iconcls="fa fa-file-text">
                            <div class="portlet-title">
                                <div class="captiontools">
                                    <a class="mini-button blue" id="ViewForm" onclick="view"><i class="fa fa-plus"></i>查看 </a>
                                </div>
                            </div>
                            <div class="mini-fit">
                                <div id="CGWL_cgfk" class="mini-datagrid" style="width: 100%; height: 100%;"
                                     allowresize="true" allowcelledit="true" multiselect="true" allowcellselect="true"
                                     idfield="Id" showpager="true">
                                    <div property="columns">
                                        <div type="indexcolumn" headeralign="center">
                                            序号
                                        </div>
                                        <div field="FKSQ_code" headeralign="center">
                                            付款申请编号
                                        </div>
                                        <div field="FKSQ_name" headeralign="center">
                                            付款申请名称
                                        </div>
                                        <div field="term" headeralign="center">
                                            期数
                                        </div>
                                        <div field="HZ_money" datatype="currency" headeralign="center" numberformat="0.000000">
                                            应付金额(万元)<input property="editor" class="mini-spinner" format="n" changeonmousewheel="false"
                                                           style="width: 100%;" readonly="True" />
                                        </div>
                                        <div field="SJ_PayM" datatype="currency" headeralign="center" numberformat="0.000000">
                                            实付金额(万元)<input property="editor" class="mini-spinner" maxValue="99999999999999" format="n" changeonmousewheel="false"
                                                           style="width: 100%;" readonly="True" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--tab 内容 end-->
                        <!-- 重要条款摘要子表-->
                        <div title="重要条款" style="text-align: left;" iconcls="fa fa-file-text">
                            <div class="mini-toolbar" id="toolbar_admin">
                                <a class="mini-button blue" id="FbContrZyList.Add" onclick="PowerForm.OnBtnAdd(this)"><i class="fa fa-plus"></i>新增</a>
                                <a class="mini-button blue" id="FbContrZyList.Save" onclick="PowerForm.OnBtnSave(this)"><i class="fa fa-save"></i>保存</a>
                                <a class="mini-button blue" id="FbContrZyList.Delete" onclick="PowerForm.OnBtnDel(this)"><i class="fa fa-trash-o"></i>删除</a>
                            </div>
                            <div class="mini-fit">
                                <div id="FbContrZyList" class="mini-datagrid" style="width: 100%; height: 100%;"
                                     allowresize="true" allowcelledit="true" multiselect="true" allowcellselect="true"
                                     idfield="Id" showpager="true" data-options="{canImport:true}">
                                    <div property="columns">
                                        <div type="indexcolumn" headeralign="center" width="15">
                                            序号
                                        </div>
                                        <div field="vType" headeralign="center" type="comboboxcolumn" width="50">
                                            条款类别
                                            <input id="FbContrZyList.vType" property="editor" class="mini-combobox" style="width: 100%;" />
                                        </div>
                                        <div field="Code" headeralign="center" width="30">
                                            条款编号
                                            <input property="editor" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                        <div field="Cont" headeralign="center">
                                            条款内容
                                            <input property="editor" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 支付条款信息-->
                        <div title="支付条款" style="text-align: left;" iconcls="fa fa-file-text">
                            <div class="mini-toolbar" id="toolbar_admin">
                                <a class="mini-button blue" id="FbContrPlanList.Add" onclick="PowerForm.OnBtnAdd(this)"><i class="fa fa-plus"></i>新增</a>
                                <a class="mini-button blue" id="FbContrPlanList.Save" onclick="PowerForm.OnBtnSave(this)"><i class="fa fa-save"></i>保存</a>
                                <a class="mini-button blue" id="FbContrPlanList.Delete" onclick="PowerForm.OnBtnDel(this)"><i class="fa fa-trash-o"></i>删除</a>
                            </div>
                            <div class="mini-fit">
                                <div id="FbContrPlanList" class="mini-datagrid" style="width: 100%; height: 100%;"
                                     allowresize="true" allowcelledit="true" multiselect="true" allowcellselect="true"
                                     idfield="Id" showpager="true" data-options="{canImport:true}">
                                    <div property="columns">
                                        <div type="indexcolumn" headeralign="center" width="35">
                                            序号
                                        </div>
                                        <div field="ZfType" headeralign="center" type="comboboxcolumn" width="60">
                                            支付类别
                                            <input id="FbContrPlanList.ZfType" name="ZfType" property="editor" class="mini-combobox"
                                                   style="width: 100%;" />
                                        </div>
                                        <div field="JgType" headeralign="center" type="comboboxcolumn" width="50">
                                            价格种类
                                            <input id="FbContrPlanList.JgType" name="JgType" property="editor" class="mini-combobox"
                                                   style="width: 100%;" />
                                        </div>
                                        <div field="FkCont" headeralign="center" width="70">
                                            付款条件
                                            <input property="editor" name="FkCont" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                        <div field="Zfbl" headeralign="center" width="50">
                                            支付比例<input property="editor" class="mini-spinner" style="width: 100%;" format="n"
                                                       changeonmousewheel="false" maxValue="99999999999999" allowlimitvalue="false" />
                                        </div>
                                        <div field="ZfCurry" headeralign="center" type="comboboxcolumn" width="50">
                                            支付币种
                                            <input id="FbContrPlanList.ZfCurry" name="ZfCurry" property="editor" class="mini-combobox"
                                                   style="width: 100%;" />
                                        </div>
                                        <div field="ZfMoney" headeralign="center" width="60" numberformat="0.000000">
                                            支付金额(万元)
                                            <input property="editor" name="ZfMoney" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                        <div width="80" field="Zfdate" allowsort="true" headeralign="center" header="计划支付日期"
                                             align="center" dateformat="yyyy-MM-dd">
                                            计划支付日期
                                            <input property="editor" name="Zfdate" class="mini-datepicker" style="width: 100%;" />
                                        </div>
                                        <div field="Remark" headeralign="center" width="100">
                                            备注
                                            <input property="editor" name="Remark" class="mini-textbox" style="width: 100%;" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 支付条款信息-->
                        <!-- 合同交货期-->
                        <!--tab 内容 -->
                        <div title="交货日期" style="text-align: left;" iconcls="fa fa-file-text">
                            <div class="mini-toolbar" id="toolbar_detail">
                                <a class="mini-button blue" id="FbContrDeliveryList.Add" onclick="PowerForm.OnBtnAdd(this)"><i class="fa fa-plus"></i>新增 </a>
                                <a class="mini-button blue" id="FbContrDeliveryList.Save" onclick="PowerForm.OnBtnSave(this)"><i class="fa fa-plus"></i>保存 </a>
                                <a class="mini-button blue" id="FbContrDeliveryList.Delete" onclick="PowerForm.OnBtnDel(this)"><i class="fa fa-trash-o"></i>删除 </a>
                            </div>
                            <div class="mini-fit">
                                <div id="FbContrDeliveryList" class="mini-datagrid" style="width: 100%; height: 100%;"
                                     allowresize="true" allowcelledit="true" multiselect="true" allowcellselect="true"
                                     idfield="Id" showpager="true" data-options="{canImport:true}">
                                    <div property="columns">
                                        <div type="indexcolumn" headeralign="center" align="right" style="width: 100%;">
                                            序号
                                        </div>
                                        <div field="SbName" headeralign="center" align="center" textname="SbName">
                                            设备名称
                                            <input id="FbContrDeliveryList.SbName" property="editor" class="mini-textbox" style="width: 100%;"
                                                   textname="SbName" />
                                        </div>
                                        <div name="JzCode" field="JzCode" headeralign="center" align="center" textname="JzCode">
                                            机组号
                                            <input id="FbContrDeliveryList.JzCode" property="editor" class="mini-textbox" style="width: 100%;"
                                                   textname="JzCode" />
                                        </div>
                                        <div field="JhAddress" headeralign="center" align="center" textname="JhAddress">
                                            交货地点
                                            <input id="FbContrDeliveryList.JhAddress" property="editor" class="mini-textbox"
                                                   style="width: 100%;" textname="JhAddress" />
                                        </div>
                                        <div field="Jhdate" allowsort="true" headeralign="center" header="合同规定交货日期" align="center"
                                             dateformat="yyyy-MM-dd">
                                            合同规定交货日期
                                            <input property="editor" name="Jhdate" class="mini-datepicker" style="width: 100%;" />
                                        </div>
                                        <div field="Remark" headeralign="center" align="center" textname="Remark">
                                            备注
                                            <input id="FbContrDeliveryList.Remark" property="editor" class="mini-textbox" style="width: 100%;"
                                                   textname="Remark" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--tab 箱件清单明细 -->
                        <!-- 合同交货期-->
                        <div title="附件" name="attachfile" url="">
                        </div>
                    </div>
                </div>
            </div>
            <!--portlet-body end-->
        </div>
    </div>
    <script type="text/javascript">
        var PowerForm = new WebForm();
        $(function () {
            PowerForm.Init();

        });
        mini.parse();

        top["win"] = window;
        function getEpsProjId() {
            return sessiondata.EpsProjId;
        }
        var htps_id = mini.get("ZhContactDetails.htps_Id").getValue();
        PowerForm.EventWizardWhere = function (e) {
            if (e.id == "ZhContactDetails.PartyBSigner") {
                var partname = formconfig.config.joindata.currow.PartyBId;
                if (partname == null || partname == undefined || partname == "") {
                    Power.ui.alert("请先选择乙方");
                    e.canOpen = false;
                    return;
                }
                else {
                    e.canOpen = true;
                    e.where = " MasterId='" + partname + "' ";
                }
            }
            if (e.id == "ZhContactDetails.partnerCode") {
                e.where = "ContractType = 'CG'"
            }
            if (e.id == "ZhConstructionContractList.Add") {
                var partname = formconfig.config.joindata.currow.htps_Id;
                if (partname == null || partname == undefined || partname == "") {
                    Power.ui.alert("请先选择合同评审");
                    e.canOpen = false;
                    return;
                }
                else {
                    e.canOpen = true;
                    e.where = "MasterId = (select x.ReviewId from SEDC_FBHT_htps x where x.Id = '" + partname + "') and MatBS_Guid not in (select B.MatBS_Guid from ZhConstructionContractList B where ContractId='" + KeyValue + "')";
                }
            }
            if (e.id == "ZhContactDetails.PartyBName") {
                    e.where = " SupplierStatus !=2 and SupplierStatus !=3 ";
            }

        }

        //在选择合同时，给金额单价赋值
        PowerForm.EventWizardData = function (e, data) {
            if (e.id == "ZhConstructionContractList.MatBS_Code") {
                data.Amount = 0;
                data.UnitPrice = 0;
            }
        }

        /*function setBghMoney()
        {
            var HtMoney = mini.get("ZhContactDetails.HtMoney").value;
            var BgMoney = mini.get("ZhContactDetails.ZbTotalMoney").value;
            mini.get("ZhContactDetails.TotalPrice").setValue(Number(HtMoney)+Number(BgMoney));
        }*/



        PowerForm.EventAfterFormLoad = function (f, data) {

            var formStat = formconfig.config.joindata.currow["Status"];
            if (FormState == "add")    //如果表单状态为添加
            {
                mini.get("ZhContactDetails.PartyAName").setValue("东方电气集团东方锅炉股份有限公司");
                mini.get("ZhContactDetails.PartyAId").setValue("bb35bf5c-6996-4c40-adee-bfeea734b4da");
                mini.get("ZhContactDetails.ContractType").setValue("CG");
                mini.get("ZhContactDetails.ContractType").allowInput = false;
                //ShowDepart("CG");

            } else {
                mini.get("ZhContactDetails.CurrencyCode").enabled = false;
            }




            //读取集采接口合同头信息
            //            var parms = { Id: formconfig.config.joindata.currow["Id"] };
            //            FormFuns.APIExec("ZhSyncContractMain", "BO", "GetContractMain", parms, function (text) {
            //                var tmp = mini.decode(text);
            //                if (tmp.success) {
            //                    var invoice = new mini.Form("ZhSyncContractMain");
            //                    invoice.setData(mini.decode(tmp.data.value));
            //                }
            //                else
            //                    Power.ui.error(tmp.message);
            //            });
        }; //在所有form加载完成后执行

        /*function ShowDepart(ConType) {


            var exec = {};  //对象
            exec.KeyWord = "ZhContactDetails";   //bo的KeyWord
            exec.MethodName = "ShowDepart"; //方法名称
            exec.MethodParams = {}; //方法参数
            var params = exec.MethodParams;
            params.contype = ConType;

            var txt = mini.encode(exec); //对象转换成字符串

            $.ajax({
                url: "/API/Exec",
                type: "POST",
                data: { jsonData: txt }, //对象字符串传递给 jsonData变量
                cache: false,
                success: function (text) {

                    var tmpdata = mini.decode(text);
                    var t = mini.decode(tmpdata.data.value);
                    mini.get("ZhContactDetails.PartyAName").setValue(t.Name);
                    mini.get("ZhContactDetails.PartyAId").setValue(t.Id);
                    formconfig.config.joindata.currow["PartyAId"] = t.Id;
                }
            });



        }*/

        PowerForm.EventBeforeOnBtnSave = function (e) {
            var getNomey = mini.get("ZhContactDetails.HtMoneys").value;
            var grid = mini.get("ZhConstructionContractList").data;
            var je = 0;
            for (var i = 0; i < grid.length; i++) {
                je += Number(grid[i].TotalPrice);
            }
            mini.get("ZhContactDetails.HtMoney").setValue(je + Number(getNomey));
            mini.get("ZhContactDetails.TotalPrice").setValue(je + Number(getNomey));
        }
        PowerForm.EventAfterOnBtnSave = function (e) {
            Sid = formconfig.config.joindata.currow["Id"];
            FormFuns.APIExec("ZhContactDetails", "BO", "GetProCgFbTechnology", { "Sid": Sid }, function (text) {
                var tmp = mini.decode(text);
                if (tmp.success) {
                    PowerForm.refresh();
                }
            });
            var getNomey = mini.get("ZhContactDetails.HtMoneys").value;
            var grid = mini.get("ZhConstructionContractList").data;
            var je = 0;
            for (var i = 0; i < grid.length; i++) {
                if (grid[i].TotalPrice == undefined) {
                    je += 0;
                }
                else {
                    je += Number(grid[i].TotalPrice);
                }
                
            }
						
            mini.get("ZhContactDetails.HtMoney").setValue(je + Number(getNomey));
            mini.get("ZhContactDetails.TotalPrice").setValue(je + Number(getNomey));
			
			
			
        }

        //把金额累计到通常页面
        //FormFuns.APIExec("ZhContactDetails", "BO", "GetProHTMoney", { "Sid": Sid }, function (text) {
        //    var tmp = mini.decode(text);
        //    if (tmp.success) {
        //        PowerForm.Init();
        //    }
        //});

        //    /*var exec={};
        //    exec.KeyWord = "ZhContactDetails";
        //    exec.MethodName = "SumMoney";
        //    exec.MethodParams = {};
        //    var params = exec.MethodParams;
        //    params.Sid = Sid;
        //    params.swhere = "";
        //    var txt = mini.encode(exec);

        //    $.ajax({
        //            url: "/API/Exec",
        //            type: "POST",
        //            data: { jsonData: txt }, //对象字符串传递给 jsonData变量
        //            cache: false,
        //            success: function (text) {
        //                var tmp = mini.decode(text);
        //                var result = tmp.data.value;
        //            }
        //    });*/

        //    FormFuns.APIExec("ZhConstructionContractList", "BO", "setRate", { "Id": Sid, "CurrencyCode": mini.get("ZhContactDetails.CurrencyCode").value }, function (text) {
        //        var tmp = mini.decode(text);
        //        if (tmp.success) {
        //            PowerForm.Init();
        //        }
        //    });


        //    //var sender = grid.sender;
        //    //var rows = e.data;
        //    //debugger
        //    //if (grid.fieldfield == "TotalPrice") {
        //    //    var sumMoney = 0;
        //    //    for (var i = 0, l = rows.length; i < l; i++) {
        //    //        var row = rows[i];
        //    //        var t = row.TotalPrice;
        //    //        sumMoney += Number(t);
        //    //    }
        //    //}
        //};

        //var grid = mini.get("ZhConstructionContractList");
        //grid.on("cellendedit", function (e) {
        //    var row = grid.getSelected();
        //    var HtilMoney = parseFloat(mini.get("ZhContactDetails.HtMoney").text);
        //    if (e.field == "Amount" || e.field == "UnitPrice") {
        //        var p = {};
        //        p.TotalPrice = Number(row.Amount) * Number(row.UnitPrice);
        //        grid.updateRow(row, p);

        //        mini.get("ZhContactDetails.HtMoney").setValue(p.TotalPrice + HtilMoney);
        //    }
        //})

        function cellendedit(e) {
            var grid = mini.get("ZhConstructionContractList");
            //var HtilMoney = mini.get("ZhContactDetails.HtMoney").getValue;
            if (e.record.PiId != null) {
                if (e.field == "PiCode" || e.field == "PiName" || e.field == "UnitName" || e.field == "Amount")
                    e.cancel = true;
            }
            var row = grid.getSelected();
            //var HtilMoney = parseFloat(mini.get("ZhContactDetails.HtMoney").text);
            if (e.field == "Amount" || e.field == "UnitPrice") {
                var p = {};
                p.TotalPrice = Number(row.Amount) * Number(row.UnitPrice);
                grid.updateRow(row, p);

                //mini.get("ZhContactDetails.HtMoney").setValue(p.TotalPrice + HtilMoney);
                //mini.get("ZhContactDetails.TotalPrice").setValue(p.TotalPrice + HtilMoney);
            }
			
		   var TotalPriceSum =0; 	
		   var row = grid.findRow(function (row) {
              TotalPriceSum +=  parseFloat(row.TotalPrice);
		   })   //通过查询函数获取行对象
		    
			//计算不含税合同金额
			// 税额 TaxAmount 不含税金额 TotalPriceTax
			var val = Number(TotalPriceSum);
			var Tax = Number(mini.get("ZhContactDetails.Tax").getValue());
			Tax = Tax/100 + 1;
			
			if(val==0) {
			   mini.get("ZhContactDetails.TotalPriceTax").setValue(0);
			   mini.get("ZhContactDetails.TaxAmount").setValue(0);
			}else{
			   var TotalPriceTax =val / Tax;
			   var TaxAmount = val - TotalPriceTax
			   mini.get("ZhContactDetails.TotalPriceTax").setValue(TotalPriceTax);
			   mini.get("ZhContactDetails.TaxAmount").setValue(TaxAmount);
			}
			
        }


        PowerForm.EventBeforeAddRow = function (e, data) {
            data.CurrencyCode = "CNY";//为子表要增加默认值的字段名称
        }

        function view() {
            var btn = { id: "CGWL_cgfk.ViewForm" };
            PowerForm.OnBtnViewForm(btn)
        }
        PowerForm.EventBeforeLoadData = function (e) {
            if (e.data.KeyWord == "CGContractChange") {
                if (e.params.swhere != "")
                    e.params.swhere += " and (Status='35' or Status ='50')";
                else
                    e.params.swhere = "(Status='35' or Status ='50')";
            }
        }
        function ViewForm() {
            var btn = { id: "CGContractChange.ViewForm" };
            PowerForm.OnBtnViewForm(btn)
        }
        function ViewFrom() {
            var PartyBId = formconfig.config.joindata.currow.PartyBId;
            if (PartyBId == null || PartyBId == "" || PartyBId == "00000000-0000-0000-0000-000000000000") {
                Power.ui.warning("请先选择乙方！");
                return;
            }
            else {
                mini.open({
                    url: "/Form/ValidForm/dd82e640-d561-4360-a298-d1f7d9b5f680/edit/" + PartyBId + "/",
                    width: "80%",
                    height: "80%"
                })
            }
        }


        function setTotal(e) {
            var val = Number(mini.get("ZhContactDetails.HtMoney").getValue());
            mini.get("ZhContactDetails.TotalPrice").setValue(val);
			
			//计算不含税合同金额
			// 税额 TaxAmount 不含税金额 TotalPriceTax
			var Tax = Number(mini.get("ZhContactDetails.Tax").getValue());
			Tax = Tax/100 + 1;
					
			if(val==0) {
			   mini.get("ZhContactDetails.TotalPriceTax").setValue(0);
			   mini.get("ZhContactDetails.TaxAmount").setValue(0);
			}else{
			   var TotalPriceTax =val / Tax;
			   
			   var TaxAmount = val - TotalPriceTax
			   mini.get("ZhContactDetails.TotalPriceTax").setValue(TotalPriceTax);
			   mini.get("ZhContactDetails.TaxAmount").setValue(TaxAmount);
			}	
        }
        //20201118 dwh 子表新增时币种赋默认值(等于主表中"合同主货币")
        PowerForm.EventBeforeAddRow = function (e, data) {
            var CurrencyCode = mini.get("ZhContactDetails.CurrencyCode").value;
            if (e.id == "ZhConstructionContractList") {
                data.CurrencyCode = CurrencyCode;
            }
            if (e.id == "FbContrPlanList") {
                data.ZfCurry = CurrencyCode;
            }
        }
    </script>
</body>
</html>
