#### 日志
* 03-08（121）
1. 新增项目管理策划。
2. 主表“项目总工期“添加计算，完工日期-启动日期。
3. 验证完工日期>启动日期。
4. 新增时“策划书编制人“默认当前项目经理
---
* 03-09（122，127）
1. 项目团队组建子表，修改向导选择后方法
2. ”需求到岗人员“允许多选，保存人员姓名，人员主键，人员主部门（重复部门只显示一次），逗号隔开
---
* 03-10（126，133，134）
1. 项目经理任命 添加字段安全总监，SafetyDirector，SafetyDirectorId
2. 分包合同管理，施工分包合同/服务采购合同，页面添加乙方过滤条件，剔除不合格和黑名单
3. 修改物资采购合同，乙方的向导，没有获取外部过滤条件，添加GetWhere()
---
* 03-11（135，125）
1. 采购命令单按项目过滤
2. 采购策划窗体所有数量和金额保留两位小数
3. 成本异动报告，添加子表和孙表，点击保存从对应投标报价获取数据
4. 成本异动报告子表/孙表加排序
5. 成本异动报告添加编辑前事件，禁止编辑除目标成本价
6. 成本异动报告添加编辑后事件，自动计算差值
---
* 03-15（140）
1. 工号创建，添加判断条件，未选中子表主合同信息，孙表工号管理禁止新增
2. 增加工号后，合同金额、合同产值的默认值设为主表中的合同金额减去已分配工号的合同金额，合同产值类同
3. 超过主合同信息金额后仅提示，不加限制
4. 项目管理策划，结束日期小于开始日期，工期为0，结束日期=开始日期
---
* 03-16（137）
1. 新增施工管理-晒图申请，主子子表结构，同页显示
2. 新增向导，选择当前项目分包施工合同对应乙方单位
3. 新增向导，选择当前项目对应主合同、工号、图号
4. 晒图申请添加过滤条件，生效或批准，合同类型为分包施工，当前项目，每个表单每个单位只能选择一次，防止子表重复数据
5. 子表添加编辑事件验证，合同号、工号禁止修改，其余可编辑
---
* 03-17
1. 晒图申请，子表添加地址字段，修改显示名称
2. 成本异动报告，差值计算不做数值大小限制
3. 项目团队组建，新增时子表自动获取获取当前项目对应项目类型、部门岗位标准化、岗位权限组名称
4. 标准部门表PB_Department添加字段OragDeptId，对应【部门岗位标准化】部门Id；标准岗位表PB_Position添加字段OragPosiId,对应【部门岗位标准化】岗位Id
---
* 03-18
项目团队组建,批准/生效后
1. 根据当前项目Id找到项目分类，根据项目分类找到【部门岗位标准化】左侧树Id，递归右侧部门写入标准部门表
2. 【部门岗位标准化】左侧树没有对应的部门，新增一个“项目部”，并写入标准部门表
3. 批准后将右侧岗位-权限组递归写入标准岗位表，但是数据源没有编码字段，直接用长编码字段代替
---
* 03-19
1. 【部门岗位标准化】如果有部门，写入标准部门表，【项目团队组建】子表选择的所有人员关联该部门，未设置主部门
2. 【项目团队组建】子表保存自动写入了【部门岗位标准化】的岗位，人员列关联该岗位
3. 【部门岗位标准化】岗位及权限组，在生成标准岗位后也一一对应
4. 生成的岗位权限组添加授权范围，默认当前项目，有权限组的自动生成
5. 项目团队组建子表为保存后获取，禁止新增删除
---
* 03-22
1. 项目经理任命修改显示名称安全总监→项目负责人
2. 项目信息表，增加项目负责人
3. 项目信息页面，项目负责人为向导，可手动选择人员
4. 项目经理任命批准后，反写项目负责人，项目经理到对应项目信息(表单向导选择的项目)
5. 【部门岗位标准化】生成岗位时添加基础岗位信息
---
* 03-23
1. 生成部门、岗位时添加到表单对应的项目下，不取当前层级（表单默认的项目）
2. 项目团队组建子表改为树形结构
3. 生成的权限组、授权范围，添加验证是否已存在，存在跳过
4. 审批通过后，形成的项目岗位需要和标准岗位一致生成树结构
5. 需要将标准岗位后的基础岗位字段值带入到对应的项目岗位的基础岗位中，为后续流程审批定义使用
---
* 03-24
1. 会议纪要，项目/企业优化
2. 添加字段，会议主持、会议类型、参与部门，参与部门Id，富文本框html
3. 标题、主持、类型、时间（精确到mm），地点为必填项
4. 主表参与部门，人员为多选
5. 内容改为富文本框
6. 企业级会议纪要，添加子表，内容，时间备注为文本框,责任部门，责任人为多选
7. 部件任务、措施任务、供外资料 按序号正序
---
* 03-25
1. 加载慢。页面每个日期字段combobox绑定了一次basdata，改为固定值
2. 月份切换 子表列显示。修改切换日期后事件，增加显示列
3. 天数计算有小数。重写日期计算方法
4. 汇总计算合计列。合计列禁止编辑，添加计算，每次修改下拉框值触发
5. 滚动条 高度切换为80%或者全屏？现在设置的高度80%
6. 导入。查询没有填写出勤合计的条目，计算赋值
7. 施工月报，周报保存报错。缺少字段
8. 施工月报，周报页面向导改为文本框，禁止编辑
---
* 03-26
1. 计划编制批准后发送消息方法重写，添加项目Id，编号，名称
2. 修改计划编制批准后发送消息标题模板
3. 个人中心，我的通知，标题列前拼接项目编号
4. 部件任务，措施任务，供外资料
5. 优化：修改显示名称，调整展示位置，主表增减少字段，添加子表
6. 子表保存后更新主表执行反馈内容
7. 窗体字段显示调整
---
* 03-29_针对菜单【部件任务】，【措施任务】，【供外任务】_
1. 子表去掉所有按钮，添加刷新按钮
2. 添加子表编辑前事件，禁止编辑子表
3. 子表状态改为预完和不能完
_新增功能_
1. 新增预反馈主表，子表
---
* 03-30_预反馈_
1. 新增保存时，根据当前录入人获取所有【部件任务】，【措施任务】，【供外任务】明细，过滤条件：设计认为录入人，状态not in('','结束','取消')
2. 子表添加重新获取按钮，重新获取所有明细
3. 明细反馈时间日期格式化显示到时分,修改为年月日
4. 添加提交按钮，点击后将与反馈的内容写道对应菜单分类的子表，并修改主表反馈内容
5. 状态和原因添加拖拽赋值y
---
* 03-31  
1. 修改菜单名称，供应方动态入围→SRM供应方，去掉新增删除编辑按钮
2. CGGL_ContSupplier添加字段引用类型，null和空值为SRM，PMS为新增，Reference为引用
3. 添加菜单工程公司供应方
4. 工程公司供应方，窗体允许新增删除，主营业务子表添加新增选择物资代码库，开户行子表，资质子表，添加新增删除按钮
5. 新增向导，选择物资代码库，左树右表，子表添加复选框，同一物资只能选择一次
---
* 04-01
1. 修改SRM供应方和工程公司供应方窗体，所有下拉框改为配置文件配置，去掉url绑定，影响加载速度
2. 主营业务子表，选择向导物资代码库，前台js赋值，默认是否可供为Y，隐藏该列
3. 开户行子表，新增行前默认是否启用为Y，隐藏该列
4. 资质子表，允许新增删除
5. 新增向导，选择SRM供应方  
6. 工程公司供应方新增时默认ReferenceType为PMS，只在工程公司供应方窗体显示；引用SRM时默认为Reference，在SRM和工程公司供应方窗体都显示
7. 窗体删除前添加判断，如果是引用的SRM，取消引用，禁止删除。
8. 编辑状态时，如果打开的是引用的，禁止编辑
---
* 04-02
1. 不合格供方管理，批准、生效后，修改供应方库合格状态
2. 物资类-供方管理，修改名称为SRM供应方，窗体保留刷新查看按钮
3. 新增向导，选择物资类SRM供应方
4. 修改表单，新增的允许编辑，主营选择物资库向导，Reference类型为PMS。
5. 引用SRM的禁止编辑
6. 窗体添加引用SRM供应方，选择物资类供方。
7. 删除事件判断是否为引用SRM，是的话取消引用不删除
8. 新增菜单，物资类供应商的 不合格供应商
9. 向导修改为选择物资类供应商
10. 修改生效、批准后时间，更新物资类供应商状态为不合格。用的施工服务类供应商表
---
* 04-06
1. 总包合同下所有菜单，菜单名和表单名称修改为销售合同
2. 销售合同，主表添加字段，原合同金额，变更金额
3. 合同点击保存后，判断首款条款汇总金额与合同金额是否一致，否则提示。
4. 添加送审前和生效前事件，判断收款条款累计金额与合同金额
5. 删除分项明细行后会有两个修改未保存的弹框，添加取消所有编辑行
---
* 04-07
1. 主表新增原合同金额，变更金额，禁止修改
2. 保存后赋值，修改后台ZHT_BreakdownBreakdown保存后事件对应存储过程`ProUpdBasicInformationMoney`，原合同金额赋值
3. 删除后赋值，修改后台SumAmount，添加原合同金额赋值计算。删除时判断分项明细左/右，更新sql语句
4. 引用标准流程js，添加流程系列按钮
5. 销售合同变更，子表新增字段，修改表单明细。折合主货币单价(万元)，原税率，变更后税率，原税额，变更后税额。字段类型对应合同分项明细
6. 变更主表为合同内变更时，明细选择销售合同分项明细，以上几个字段带过来
7. 子表添加字段不含税金额(万元)，明细向导唯一表单只允许选择一次
9. 变更明细计算方式，修改单价，数量，汇率，税率的计算方式
---
* 04-08
1. 修改变更选择原合同向导的显示列，想到选择完后，变更内的原合同金额赋值为原合同的合同折合主货币总价(万元)。
2. 变更内的变更编号，名称改为必填。变更类型为合同外时，反写作为分项的左侧grid
3. 合同变更内，子表可编辑列修改
4. 销售合同变更，后台添加，保存后更新主表本次变更核准金额（万元）
5. 合同表单分项明细左侧删除时弹框确认去除
6. 变更选择合同向导，只有批准或生效的才能选择
---
* 04-09
1. 合同变更批准后，合同外变更，把主表编号名称赋值到主合同分项明细左侧，明细作为孙表赋值到分项明细右侧，重新计算合同变更金额，变更后金额，税额，不含税金额
2. 合同变更批准后，合同内变更，子表选择的明细对应主表分项明细更新，再重新计算合同变更金额，变更后金额，税额，不含税金额
3. 销售合同信息table页签添加合同变更，双击打开对应合同变更表单
4. 设计向导，选择主合同明细，选择主合同修改
---
* 04-12
1. 销售主合同/变更信息，添加税率，税额计算方式
2. 年度计划，经营计划，年度计划编制，字段计划成台时间，首款比例，已收款修改为只读
3. 销售合同，管理收费管理，收款计划，主表合同名称向导，合同金额，子表工作号不允许输入。
4. 收款计划子表选择工号向导，按照主表合同过滤
5. 收款计划子表选择工号向导，打开前先判断主表是否选择了合同
---
* 04-13
1. 年度计划编制，项目分类取值改为关联项目信息的项目类型，原来关联的是产品类型
2. 收款计划子表为实际收款上半部分表，添加字段WorkCodeId，存储工号信息主键
3. 修改收款计划子表选择工号向导，保存工号Id到WorkCodeId，保存合同Id到GLHTID，便于报表查询，不然没有关联关系
4. 修改存储过程v_yearplan_edit，已收款金额为对应合同已批准的收款计划子表对应的已提交实际收款额之和，首款比例为已收款金额/合同金额
---
* 04-14
1. 销售合同变更优化
2. 工程公司供应方，物资类和施工服务类。新增两个向导选择对应的SRM供方库，左右结构
3. 修改向导选择后逻辑，原来为单选，选择完后打开对应表单。修改为多选，选择完后默认不打开
4. 物资采购合同登记,主表采购合同必填
5. 修改从采购文件选择向导过滤条件，原物资分类Id改为定标信息子表Id
6. 物资采购合同登记，子表验证物资分类删除，子表物资分类列去掉
---
* 04-15
1. 定标信息主表添加字段 采购命令单主键-PurchaseOrderId,子表添加字段 采购命令单明细主键-PurchaseOrderListId,物资主键-MatId
2. 物资采购合同，从采购文件选择时赋值MatId为物资Id，PIId为定标信息明细Id
3. 采购合同明细，添加汇率计算
4. 采购合同明细，添加编辑前时间，指定列禁止编辑
5. 采购合同添加流程系列按钮，去掉多余引用js
6. 调整报错信息，注释（保存后税率重新赋值计算）
7. 合同评审向导，三个表单都改为必选
---
* 04-16
1. 分包、采购、服务合同，添加方法，新增选择合同审查后，子表带出合同审查对应定标信息明细
2. 表单编辑状态时，修改选择的合同审核，先清空明细，再重新获取定标信息
3. 分包/服务合同子表treegrid改为datagrid，修改列名
4. 添加编辑前事件，禁止编辑列；编辑后事件，添加计算
5. 三个合同表单添加向导选择物资库/选择定标明细，修改配置文件
---
* 04-19
*分包合同三种类型对应的收到发票菜单*
1. 添加流程系列JS引用，显示流程系列按钮，添加ControlCenter引用
2. 修改表单名称为对应菜单名
3. 施工分包合同隐藏字段预缴税地点(分区)
4. 主表添加字段税率,下拉框。添加主表税率修改后计算,onvaluechange
5. 修改配置文件，删除原子表，改为新的子表关键词，添加税率下拉框对应配置文件
6. 添加子表发票拆分FbInvoiceRecords_CF，字段工号，金额，备注
---
* 04-20
*分包合同三种类型对应的收到发票菜单*
1. 表单htm，删除原子表，添加新子表发票拆分
2. 新增向导，选择工号，默认选择所有工号
3. 子表新增按钮改为选择向导，多选。添加向导选择前过滤条件，主表选择合同的EPSProjId对应的所有销售合同对应的所有工号
4. 子表工号列改为选择向导，单选，添加同样条件
5. 选择过的不允许再选（单一合同内）
6. 主表未选择合同，添加提示并不允许打开向导
7. 注释原保存后事件
8. 添加计算，保存后触发,汇总子表金额到主表金额，重新计算税额，含税总金额
10. 批量复制功能修改，分包合同添加是否生效判断，原来报错的修改。修改后台复制新增的子表
---
* 04-21
1. 收到发票，修改批量复制功能
2. 施工分包合同收到发票，计算修改，删除保存后时间
3. 分包合同施工物资采购对应合同登记，合同编号改为合同号（C号），合同号（C号）改为合同流水号
4. 新增向导，选择工号复选，显示计划成台时间
5. 修改菜单名称 采购策划→采购组包，新增菜单采购策划
---
* 04-22
1. 新增窗体采购策划，关键词为原采购组包子表
2. 添加字段14个
3. 工号选择向导，多选拼接工号逗号隔开，拼接项目成台时间，逗号隔开，去重
4. 工号向导添加过滤，选择当前项目的所有工号
5. 默认项目名称，编号，Id带session的
6. 默认带出项目经理，当前项目项目信息取值
7. 默认带出采购经理，当前项目基础岗位为采购经理的
8. 添加编辑前事件，新增行前事件，向导选择前后逻辑
---
* 04-23
1. 菜单名称修改，进度计划→设计计划编制，添加新菜单，采购计划编制
2. 新建主子表，采购计划编制
3. 采购计划编制 主表默认标题和当前月份
4. 采购计划编制 添加后台，保存后自动带出当前项目所有采购策划明细
5. 采购计划编制子表部分字段允许编辑
6. 批准生效后，反写子表编辑后字段到采购策划
---
* 04-28
1. 采购策划，添加列【采购策划标题】，修改列名采购策划编号
2. 采购组包，删除新增、删除按钮，隐藏三列时间
3. 采购计划编制，页面加载后默认选中过滤条件【全部】
4. 子表添加默认过滤条件，是否下达采购命令单，已下达
5. 添加【下月】，【是否下达采购命令单】过滤条件
6. 采购策划，类别、要求到货日期、要求定标日期隐藏
7. 计划到货日期，计划定标日期只读
8. 采购组包，默认不加载【定标实际完成时间】有值的数据,切【是否下达采购命令单】为未下达
---
* 04-29
1. 采购组包上侧树，去掉过滤条件【剩余需求数量】>0
2. 修改生成采购命令单后台，生成后反写采购策划字段【是否下达采购命令单】为已下达
3. 采购命令单添加删除事件，删除前把对应采购策划字段【是否下达采购命令单】IsOrderPurchase改为未下达
4. 物资→收到发票 窗体和表单字段名称修改。不含税总金额
5. 采购合同→合同评审，合同编号只读
---
* 05-06
1. 进度计划→计划汇总，新增页签【采购计划】，显示采购策划数据
2. 修改配置文件，添加子表，添加Basedata下拉框
3. 采购管理，合同审查报错，修正EventWizardData事件，字符串拼接
4. 定标编号、名称改为招标编号、名称
5. 选择定标信息向导添加项目过滤
6. 配置文件的filter双引号内如果有空格，过滤条件会拼接and ()导致报错
7. 选择定标信息向导为添加外部过滤条件Select.GetWhere()
---
* 05-07
1. 定标信息明细，添加总金额列，只读，编辑单价/金额自动计算
2. 定标信息主表添加总金额字段，不显示，每次保存后获取子表金额之和
3. 合同评审选择定标信息后，默认价格字段为总金额，可编辑
4. 计划汇总，四个页签默认不分组，点击按项目分组后按照项目分组，项目名称倒序
5. 部件、措施、供外 添加gridFilter查询
6. 采购计划添加gridfilter查询，类型，采买方式，是否下达采购命令单为下拉框，修改配置文件
---
* 05-10
1. 会议室预约，添加按钮【日历显示】【列表显示】，点击日历加载fullcalendar控件隐藏grid，点击列表加载grid隐藏fullcalendar
2. 添加过滤查询会议室编号 ，会议日期，开始时间，结束时间。开始结束时间：大于等于开始时间，小于等于结束时间
3. 当前登陆人为编辑人才能取消预约和修改，原有功能未调整
4. 修改表单样式,width:100%,添加fullcalendar月、周、日显示
---
* 05-11
1. 批量导入项目信息
2. 项目信息菜单修改，引用js，添加导入按钮
3. 后台添加导入方法，添加判断：导入为空、项目编号/项目名称为空、判断是否存在改项目编号
4. 获取数据：项目经理、执行经理、获取最大的project_id、产品类型复选
5. 修改导入方法，支持导入项目时多页签含”项目信息表“的都导入，但第一个页签必须为项目信息表
6. 导入数据去除首位、居中空格
7. 修改导入方法，支持只导入标签名含指定字符串的页签内容
* 05-12
1. 批量导入销售合同
2. 销售合同菜单修改，引用js，添加导入按钮
3. 后台添加导入方法，添加判断：导入为空、合同号，合同名称为空跳过、是否已存在该合同，根据编号查找
4. 数据验证：合同性质、合同金额、项目编号、名称、Id、录入日期、甲方单位
5. 批量导入工号
6. 工号菜单修改，引用js，添加导入按钮
7. 后台添加导入方法，添加判断：导入为空、工号，项目简称，为空跳过、合同号为空的无法建立关联，跳过，根据编号查找
8. 数据验证：产值、金额、外键-主合同主键、合同成台时间、计划成台时间、图号
9. 项目：项目编号/项目名称为空，跳过；主合同：合同号/合同名称为空跳过；工号：工号/项目简称为空跳过
---
* 05-19
1. 项目，销售合同，工号，收款计划，分包合同，收票，资金计划 批量导入
Project
ZHT_BasicInformation
ZHT_WorkCode
ZHT_BreakdownBreakdown_New
ZhContactDetails/Zh_ContactDetails
FbInvoiceRecords/FbInvoiceRecords
2. 工程视频监控，分为左右结构，左侧项目，右侧监控页面，分上下栏位，上栏位显示几分屏，右栏位显示摄像头控制按钮
---
* 05-26
1. 销售合同信息-首款条款，支持输入金额计算比例
2. 收费管理-收款计划-收款明细，支持输入金额计算比例
3. 施工分包-收到发票；物资采购-收到发票；服务采购-收到发票，子表去掉分页，添加均分按钮，点击弹出输入框，输入金额后均分到子表明细金额
4. 视频监控，修改左右展开样式
5. 销售合同-收款条款列不能为空，去掉分页
6. 收款计划-列首款条件不能为空，去掉分页
7. 质量验评划分,配置文件修改，没有对应的列
8. 质量验评划分业务对象PS_QBS没有点亮，新加的列，拼音的都没有写入，数据库新增，业务对象新增
9. 前端js的 fileup注释，用配置文件的导入
10. 修改模板
---
* 05-27
1. 数据库新增表ZLGL_QBSTemplate，ZLGL_QBSTemplate_dtl
2. 新增窗体表单-质量管理_质量验评模板
3. 新增向导，选择质量验评模板，添加查看列，打开对应表单
4. 重写质量验评引用，点击后打开上述向导，选择后清除原内容，写入对应子表
5. 添加保存为模板，点击后填写标题，生成新的质量验评模板
---
* 05-31
1. 复制质量验评模板
2. 数据库新建表综合管理_分发反馈，综合管理_反馈分发
3. 综合管理_反馈分发业务对象 添加外键属性，关联外键属性
---
* 06-02
1. 分发反馈
2. 反馈分发
---
* 06-03
1. 费用管理,发票保函管理,开出发票申请 
2. 项目组建，多选人员向导打开后自动赋值已选人员
---
* 06-04
1. 询价结果记录
---
* 06-08
1. 反馈表单，添加反馈状态，反馈时间点击反馈按钮后生成，多次反馈不修改第一次反馈时间
2. 销售合同保存报错
3. 周报台账
---
* 06-09
1. 分发反馈，选用管理员为代发人，修改接收人为子表人员数量
2. 子表选人后触发一次保存
---
* 至06-17
1. 不符合项纠正通知单
2. 生成签章带日期，拼接图片，
3. 考勤添加出差合计
4. 分发反馈添加分发时间
5. 添加菜单综合管理、文档管理、签章记录
6. 分发反馈报表
7. 用户管理菜单+附件页签，显示生成的签章
---
* 06-21
1. 分发反馈报表，排序
2. 报表每个数量要按照日期过滤，每个子查询需要关联主表
---
* 06-29
1. 选择物资采购合同进场凭证
2. 选择服务采购合同采购确认单
3. 物资采购合同-用款审批
4. 服务采购合同-用款审批
5. 施工分包合同-用款审批
6. 货物进场时间
---
* 07-08
1. 视频监控，添加项目名称
2. 特殊工种维护
3. 人员信息采集，添加字段，重写导入，导入后判断年龄
4. 特种人员报表
5. 三级教育，导入
6. 安全培训
7. 体检报告，导入
8. 人员保险，导入
---
* 07-

